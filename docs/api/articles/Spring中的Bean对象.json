{"title":"Springä¸­çš„Beanå¯¹è±¡","slug":"Springä¸­çš„Beanå¯¹è±¡","date":"2023-03-03T08:37:59.487Z","updated":"2023-06-04T08:35:28.400Z","comments":true,"path":"api/articles/Springä¸­çš„Beanå¯¹è±¡.json","excerpt":null,"covers":"https://picx.zhimg.com/v2-5668c094310c3d27b25ea3df98b9e43c_1440w.jpg","content":"\r\n\r\n## Spring IoC\r\n\r\n### è°ˆè°ˆè‡ªå·±å¯¹äºSpring IoCçš„äº†è§£\r\n\r\n**IoCï¼ˆInversionofControl:æ§åˆ¶åè½¬ï¼‰**æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå…·ä½“çš„æŠ€æœ¯å®ç°ã€‚IoCçš„æ€æƒ³å°±æ˜¯å°†åŸæœ¬åœ¨ç¨‹åºä¸­æ‰‹åŠ¨åˆ›å»ºå¯¹è±¡çš„æ§åˆ¶æƒï¼Œäº¤ç”±Springæ¡†æ¶æ¥ç®¡ç†ã€‚ä¸è¿‡ï¼ŒIoCå¹¶éSpringç‰¹æœ‰ï¼Œåœ¨å…¶ä»–è¯­è¨€ä¸­ä¹Ÿæœ‰åº”ç”¨ã€‚\r\n\r\n**ä¸ºä»€ä¹ˆå«æ§åˆ¶åè½¬ï¼Ÿ**\r\n\r\n- **æ§åˆ¶**ï¼šæŒ‡çš„æ˜¯å¯¹è±¡åˆ›å»ºï¼ˆå®ä¾‹åŒ–ã€ç®¡ç†ï¼‰çš„æƒåŠ›\r\n- **åè½¬**ï¼šæ§åˆ¶æƒäº¤ç»™å¤–éƒ¨ç¯å¢ƒï¼ˆSpringæ¡†æ¶ã€IoCå®¹å™¨ï¼‰\r\n\r\n![img](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/java-guide-blog/frc-365faceb5697f04f31399937c059c162.png)\r\n\r\nå°†å¯¹è±¡ä¹‹é—´çš„ç›¸äº’ä¾èµ–å…³ç³»äº¤ç»™IoCå®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ç”±IoCå®¹å™¨å®Œæˆå¯¹è±¡çš„æ³¨å…¥ã€‚è¿™æ ·å¯ä»¥å¾ˆå¤§ç¨‹åº¦ä¸Šç®€åŒ–åº”ç”¨çš„å¼€å‘ï¼ŒæŠŠåº”ç”¨ä»å¤æ‚çš„ä¾èµ–å…³ç³»ä¸­è§£æ”¾å‡ºæ¥ã€‚IoCå®¹å™¨å°±åƒæ˜¯ä¸€ä¸ªå·¥å‚ä¸€æ ·ï¼Œå½“æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œåªéœ€è¦é…ç½®å¥½é…ç½®æ–‡ä»¶/æ³¨è§£å³å¯ï¼Œå®Œå…¨ä¸ç”¨è€ƒè™‘å¯¹è±¡æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ã€‚\r\n\r\nåœ¨å®é™…é¡¹ç›®ä¸­ä¸€ä¸ªServiceç±»å¯èƒ½ä¾èµ–äº†å¾ˆå¤šå…¶ä»–çš„ç±»ï¼Œå‡å¦‚æˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–è¿™ä¸ªServiceï¼Œä½ å¯èƒ½è¦æ¯æ¬¡éƒ½è¦ææ¸…è¿™ä¸ªServiceæ‰€æœ‰åº•å±‚ç±»çš„æ„é€ å‡½æ•°ï¼Œè¿™å¯èƒ½ä¼šæŠŠäººé€¼ç–¯ã€‚å¦‚æœåˆ©ç”¨IoCçš„è¯ï¼Œä½ åªéœ€è¦é…ç½®å¥½ï¼Œç„¶ååœ¨éœ€è¦çš„åœ°æ–¹å¼•ç”¨å°±è¡Œäº†ï¼Œè¿™å¤§å¤§å¢åŠ äº†é¡¹ç›®çš„å¯ç»´æŠ¤æ€§ä¸”é™ä½äº†å¼€å‘éš¾åº¦ã€‚\r\n\r\nåœ¨Springä¸­ï¼ŒIoCå®¹å™¨æ˜¯Springç”¨æ¥å®ç°IoCçš„è½½ä½“ï¼ŒIoCå®¹å™¨å®é™…ä¸Šå°±æ˜¯ä¸ªMapï¼ˆkeyï¼Œvalueï¼‰ï¼ŒMapä¸­å­˜æ”¾çš„æ˜¯å„ç§å¯¹è±¡ã€‚\r\n\r\nSpringæ—¶ä»£æˆ‘ä»¬ä¸€èˆ¬é€šè¿‡XMLæ–‡ä»¶æ¥é…ç½®Beanï¼Œåæ¥å¼€å‘äººå‘˜è§‰å¾—XMLæ–‡ä»¶æ¥é…ç½®ä¸å¤ªå¥½ï¼Œäºæ˜¯SpringBootæ³¨è§£é…ç½®å°±æ…¢æ…¢å¼€å§‹æµè¡Œèµ·æ¥ã€‚\r\n\r\nç›¸å…³é˜…è¯»ï¼š\r\n\r\n- [IoCæºç é˜…è¯»](https://javadoop.com/post/spring-ioc)\r\n- [é¢è¯•è¢«é—®äº†å‡ ç™¾éçš„IoCå’ŒAOPï¼Œè¿˜åœ¨å‚»å‚»æä¸æ¸…æ¥šï¼Ÿ](https://mp.weixin.qq.com/s?__biz=Mzg2OTA0Njk0OA==&mid=2247486938&idx=1&sn=c99ef0233f39a5ffc1b98c81e02dfcd4&chksm=cea24211f9d5cb07fa901183ba4d96187820713a72387788408040822ffb2ed575d28e953ce7&token=1736772241&lang=zh_CN#rd)\r\n\r\n### ä»€ä¹ˆæ˜¯Spring Beanï¼Ÿ\r\n\r\nç®€å•æ¥è¯´ï¼ŒBeanä»£æŒ‡çš„å°±æ˜¯é‚£äº›è¢«IoCå®¹å™¨æ‰€ç®¡ç†çš„å¯¹è±¡ã€‚\r\n\r\næˆ‘ä»¬éœ€è¦å‘Šè¯‰IoCå®¹å™¨å¸®åŠ©æˆ‘ä»¬ç®¡ç†å“ªäº›å¯¹è±¡ï¼Œè¿™ä¸ªæ˜¯é€šè¿‡é…ç½®å…ƒæ•°æ®æ¥å®šä¹‰çš„ã€‚é…ç½®å…ƒæ•°æ®å¯ä»¥æ˜¯XMLæ–‡ä»¶ã€æ³¨è§£æˆ–è€…Javaé…ç½®ç±»ã€‚\r\n\r\n```xml\r\n<!-- Constructor-arg with 'value' attribute -->\r\n<bean id=\"...\" class=\"...\">\r\n   <constructor-arg value=\"...\"/>\r\n</bean>\r\n```\r\n\r\nä¸‹å›¾ç®€å•åœ°å±•ç¤ºäº†IoCå®¹å™¨å¦‚ä½•ä½¿ç”¨é…ç½®å…ƒæ•°æ®æ¥ç®¡ç†å¯¹è±¡ã€‚\r\n\r\n![img](https://guide-blog-images.oss-cn-shenzhen.aliyuncs.com/github/javaguide/system-design/framework/spring/062b422bd7ac4d53afd28fb74b2bc94d.png)\r\n\r\n**org.springframework.beans**å’Œ**org.springframework.context**è¿™ä¸¤ä¸ªåŒ…æ˜¯IoCå®ç°çš„åŸºç¡€ï¼Œå¦‚æœæƒ³è¦ç ”ç©¶IoCç›¸å…³çš„æºç çš„è¯ï¼Œå¯ä»¥å»çœ‹çœ‹\r\n\r\n### å°†ä¸€ä¸ªç±»å£°æ˜ä¸ºBeançš„æ³¨è§£æœ‰å“ªäº›?\r\n\r\n- @Componentï¼šé€šç”¨çš„æ³¨è§£ï¼Œå¯æ ‡æ³¨ä»»æ„ç±»ä¸ºSpringç»„ä»¶ã€‚å¦‚æœä¸€ä¸ªBeanä¸çŸ¥é“å±äºå“ªä¸ªå±‚ï¼Œå¯ä»¥ä½¿ç”¨@Componentæ³¨è§£æ ‡æ³¨ã€‚\r\n- @Repository:å¯¹åº”æŒä¹…å±‚å³Daoå±‚ï¼Œä¸»è¦ç”¨äºæ•°æ®åº“ç›¸å…³æ“ä½œã€‚\r\n- @Service:å¯¹åº”æœåŠ¡å±‚ï¼Œä¸»è¦æ¶‰åŠä¸€äº›å¤æ‚çš„é€»è¾‘ï¼Œéœ€è¦ç”¨åˆ°Daoå±‚ã€‚\r\n- @Controller:å¯¹åº”SpringMVCæ§åˆ¶å±‚ï¼Œä¸»è¦ç”¨äºæ¥å—ç”¨æˆ·è¯·æ±‚å¹¶è°ƒç”¨Serviceå±‚è¿”å›æ•°æ®ç»™å‰ç«¯é¡µé¢ã€‚\r\n\r\n### @Componentå’Œ@Beançš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\r\n\r\n- @Componentæ³¨è§£ä½œç”¨äºç±»ï¼Œè€Œ@Beanæ³¨è§£ä½œç”¨äºæ–¹æ³•ã€‚\r\n- @Componenté€šå¸¸æ˜¯é€šè¿‡ç±»è·¯å¾„æ‰«ææ¥è‡ªåŠ¨ä¾¦æµ‹ä»¥åŠè‡ªåŠ¨è£…é…åˆ°Springå®¹å™¨ä¸­ï¼ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@ComponentScanæ³¨è§£å®šä¹‰è¦æ‰«æçš„è·¯å¾„ä»ä¸­æ‰¾å‡ºæ ‡è¯†äº†éœ€è¦è£…é…çš„ç±»è‡ªåŠ¨è£…é…åˆ°Springçš„beanå®¹å™¨ä¸­ï¼‰ã€‚@Beanæ³¨è§£é€šå¸¸æ˜¯æˆ‘ä»¬åœ¨æ ‡æœ‰è¯¥æ³¨è§£çš„æ–¹æ³•ä¸­å®šä¹‰äº§ç”Ÿè¿™ä¸ªbean,@Beanå‘Šè¯‰äº†Springè¿™æ˜¯æŸä¸ªç±»çš„å®ä¾‹ï¼Œå½“æˆ‘éœ€è¦ç”¨å®ƒçš„æ—¶å€™è¿˜ç»™æˆ‘ã€‚\r\n- @Beanæ³¨è§£æ¯”@Componentæ³¨è§£çš„è‡ªå®šä¹‰æ€§æ›´å¼ºï¼Œè€Œä¸”å¾ˆå¤šåœ°æ–¹æˆ‘ä»¬åªèƒ½é€šè¿‡@Beanæ³¨è§£æ¥æ³¨å†Œbeanã€‚æ¯”å¦‚å½“æˆ‘ä»¬å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ä¸­çš„ç±»éœ€è¦è£…é…åˆ°Springå®¹å™¨æ—¶ï¼Œåˆ™åªèƒ½é€šè¿‡@Beanæ¥å®ç°ã€‚\r\n\r\n@Beanæ³¨è§£ä½¿ç”¨ç¤ºä¾‹ï¼š\r\n\r\n```java\r\n@Configuration\r\npublic class AppConfig {\r\n    @Bean\r\n    public TransferService transferService() {\r\n        return new TransferServiceImpl();\r\n    }\r\n\r\n}\r\n```\r\nä¸Šé¢çš„ä»£ç ç›¸å½“äºä¸‹é¢çš„xmlé…ç½®\r\n\r\n```xml\r\n<beans>\r\n    <bean id=\"transferService\" class=\"com.acme.TransferServiceImpl\"/>\r\n</beans>\r\n```\r\n\r\nä¸‹é¢è¿™ä¸ªä¾‹å­æ˜¯é€šè¿‡@Componentæ— æ³•å®ç°çš„ã€‚\r\n\r\n```java\r\n@Bean\r\npublic OneService getService(status) {\r\n    case (status)  {\r\n        when 1:\r\n                return new serviceImpl1();\r\n        when 2:\r\n                return new serviceImpl2();\r\n        when 3:\r\n                return new serviceImpl3();\r\n    }\r\n}\r\n```\r\n\r\n### æ³¨å…¥Beançš„æ³¨è§£æœ‰å“ªäº›ï¼Ÿ\r\n\r\nSpringå†…ç½®çš„@Autowiredä»¥åŠJDKå†…ç½®çš„@Resourceå’Œ@Injectéƒ½å¯ä»¥ç”¨äºæ³¨å…¥Beanã€‚\r\n\r\n| Annotaion    | Package                            | Source       |\r\n| ------------ | ---------------------------------- | ------------ |\r\n| @Autowired | org.springframework.bean.factory | Spring 2.5+  |\r\n| @Resource  | javax.annotation                 | Java JSR-250 |\r\n| @Inject    | javax.inject                     | Java JSR-330 |\r\n\r\n@Autowiredå’Œ@Resourceä½¿ç”¨çš„æ¯”è¾ƒå¤šä¸€äº›ã€‚\r\n\r\n### @Autowiredå’Œ@Resourceçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ\r\n\r\nAutowiredå±äºSpringå†…ç½®çš„æ³¨è§£ï¼Œé»˜è®¤çš„æ³¨å…¥æ–¹å¼ä¸ºbyTypeï¼ˆæ ¹æ®ç±»å‹è¿›è¡ŒåŒ¹é…ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šä¼˜å…ˆæ ¹æ®æ¥å£ç±»å‹å»åŒ¹é…å¹¶æ³¨å…¥Beanï¼ˆæ¥å£çš„å®ç°ç±»ï¼‰ã€‚\r\n\r\n**è¿™ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ**å½“ä¸€ä¸ªæ¥å£å­˜åœ¨å¤šä¸ªå®ç°ç±»çš„è¯ï¼ŒbyTypeè¿™ç§æ–¹å¼å°±æ— æ³•æ­£ç¡®æ³¨å…¥å¯¹è±¡äº†,å› ä¸ºè¿™ä¸ªæ—¶å€™Springä¼šåŒæ—¶æ‰¾åˆ°å¤šä¸ªæ»¡è¶³æ¡ä»¶çš„é€‰æ‹©ï¼Œé»˜è®¤æƒ…å†µä¸‹å®ƒè‡ªå·±ä¸çŸ¥é“é€‰æ‹©å“ªä¸€ä¸ªã€‚\r\n\r\nè¿™ç§æƒ…å†µä¸‹ï¼Œæ³¨å…¥æ–¹å¼ä¼šå˜ä¸ºbyNameï¼ˆæ ¹æ®åç§°è¿›è¡ŒåŒ¹é…ï¼‰ï¼Œè¿™ä¸ªåç§°é€šå¸¸å°±æ˜¯ç±»åï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚å°±æ¯”å¦‚è¯´ä¸‹é¢ä»£ç ä¸­çš„smsServiceå°±æ˜¯æˆ‘è¿™é‡Œæ‰€è¯´çš„åç§°ï¼Œè¿™æ ·åº”è¯¥æ¯”è¾ƒå¥½ç†è§£äº†å§ã€‚\r\n\r\n\r\n```java\r\n// smsServiceå°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„åç§°\r\n@Autowired\r\nprivate SmsService smsService;\r\n```\r\n\r\nä¸¾ä¸ªä¾‹å­ï¼ŒSmsServiceæ¥å£æœ‰ä¸¤ä¸ªå®ç°ç±»:SmsServiceImpl1å’ŒSmsServiceImpl2ï¼Œä¸”å®ƒä»¬éƒ½å·²ç»è¢«Springå®¹å™¨æ‰€ç®¡ç†ã€‚\r\n\r\n\r\n```java\r\n// æŠ¥é”™ï¼ŒbyNameå’ŒbyTypeéƒ½æ— æ³•åŒ¹é…åˆ°bean\r\n@Autowired\r\nprivate SmsService smsService;\r\n\r\n// æ­£ç¡®æ³¨å…¥SmsServiceImpl1å¯¹è±¡å¯¹åº”çš„bean\r\n@Autowired\r\nprivate SmsService smsServiceImpl1;\r\n\r\n// æ­£ç¡®æ³¨å…¥SmsServiceImpl1å¯¹è±¡å¯¹åº”çš„bean\r\n// smsServiceImpl1å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æ‰€è¯´çš„åç§°\r\n@Autowired\r\n@Qualifier(value=\"smsServiceImpl1\")\r\nprivate SmsService smsService;\r\n```\r\n\r\næˆ‘ä»¬è¿˜æ˜¯å»ºè®®é€šè¿‡@Qualifieræ³¨è§£æ¥æ˜¾å¼æŒ‡å®šåç§°è€Œä¸æ˜¯ä¾èµ–å˜é‡çš„åç§°ã€‚\r\n\r\n@Resourceå±äºJDKæä¾›çš„æ³¨è§£ï¼Œé»˜è®¤æ³¨å…¥æ–¹å¼ä¸ºbyNameã€‚å¦‚æœæ— æ³•é€šè¿‡åç§°åŒ¹é…åˆ°å¯¹åº”çš„Beançš„è¯ï¼Œæ³¨å…¥æ–¹å¼ä¼šå˜ä¸ºbyTypeã€‚\r\n\r\n@Resourceæœ‰ä¸¤ä¸ªæ¯”è¾ƒé‡è¦ä¸”æ—¥å¸¸å¼€å‘å¸¸ç”¨çš„å±æ€§ï¼šnameï¼ˆåç§°ï¼‰ã€typeï¼ˆç±»å‹ï¼‰ã€‚\r\n\r\n```java\r\npublic @interface Resource {\r\n    String name() default \"\";\r\n    Class<?> type() default Object.class;\r\n}\r\n```\r\n\r\nå¦‚æœä»…æŒ‡å®š`name`å±æ€§åˆ™æ³¨å…¥æ–¹å¼ä¸º`byName`ï¼Œå¦‚æœä»…æŒ‡å®š`type`å±æ€§åˆ™æ³¨å…¥æ–¹å¼ä¸º`byType`ï¼Œå¦‚æœåŒæ—¶æŒ‡å®š`name`å’Œ`type`å±æ€§ï¼ˆä¸å»ºè®®è¿™ä¹ˆåšï¼‰åˆ™æ³¨å…¥æ–¹å¼ä¸º`byType`+`byName`ã€‚\r\n\r\n```java\r\n// æŠ¥é”™ï¼ŒbyNameå’ŒbyTypeéƒ½æ— æ³•åŒ¹é…åˆ°bean\r\n@Resource\r\nprivate SmsService smsService;\r\n\r\n// æ­£ç¡®æ³¨å…¥SmsServiceImpl1å¯¹è±¡å¯¹åº”çš„bean\r\n@Resource\r\nprivate SmsService smsServiceImpl1;\r\n\r\n// æ­£ç¡®æ³¨å…¥SmsServiceImpl1å¯¹è±¡å¯¹åº”çš„beanï¼ˆæ¯”è¾ƒæ¨èè¿™ç§æ–¹å¼ï¼‰\r\n@Resource(name = \"smsServiceImpl1\")\r\nprivate SmsService smsService;\r\n```\r\n\r\nç®€å•æ€»ç»“ä¸€ä¸‹ï¼š\r\n\r\n- @Autowiredæ˜¯Springæä¾›çš„æ³¨è§£ï¼Œ@Resourceæ˜¯JDKæä¾›çš„æ³¨è§£ã€‚\r\n- Autowiredé»˜è®¤çš„æ³¨å…¥æ–¹å¼ä¸ºbyTypeï¼ˆæ ¹æ®ç±»å‹è¿›è¡ŒåŒ¹é…ï¼‰ï¼Œ@Resourceé»˜è®¤æ³¨å…¥æ–¹å¼ä¸ºbyNameï¼ˆæ ¹æ®åç§°è¿›è¡ŒåŒ¹é…ï¼‰ã€‚\r\n- å½“ä¸€ä¸ªæ¥å£å­˜åœ¨å¤šä¸ªå®ç°ç±»çš„æƒ…å†µä¸‹ï¼Œ@Autowiredå’Œ@Resourceéƒ½éœ€è¦é€šè¿‡åç§°æ‰èƒ½æ­£ç¡®åŒ¹é…åˆ°å¯¹åº”çš„Beanã€‚Autowiredå¯ä»¥é€šè¿‡@Qualifieræ³¨è§£æ¥æ˜¾å¼æŒ‡å®šåç§°ï¼Œ@Resourceå¯ä»¥é€šè¿‡nameå±æ€§æ¥æ˜¾å¼æŒ‡å®šåç§°ã€‚\r\n\r\n**@Autowiredå’Œ@ResourceåŒºåˆ«**ğŸ˜Š\r\n\r\n1. @Autowiredä¸@Resourceéƒ½å¯ä»¥ç”¨æ¥è£…é…bean,éƒ½å¯ä»¥å†™åœ¨å­—æ®µä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Šã€‚\r\n2. @Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ˆè¿™ä¸ªæ³¨è§£æ˜¯å±äºspringçš„ï¼‰,é»˜è®¤æƒ…å†µä¸‹å¿…é¡»è¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœè¦å…è®¸nullå€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒçš„requiredå±æ€§ä¸ºfalseï¼Œå¦‚ï¼š@Autowired(required=false)ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨åç§°è£…é…å¯ä»¥ç»“åˆ@Qualifieræ³¨è§£è¿›è¡Œä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š\r\n\r\n```java\r\n@Autowired ()\r\n@Qualifier (\"baseDao\")\r\nprivate BaseDao baseDao;\r\n```\r\n\r\n3. @Resourceï¼ˆè¿™ä¸ªæ³¨è§£å±äºJ2EEçš„ï¼‰ï¼Œé»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œåç§°å¯ä»¥é€šè¿‡nameå±æ€§è¿›è¡ŒæŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šnameå±æ€§ï¼Œå½“æ³¨è§£å†™åœ¨å­—æ®µä¸Šæ—¶ï¼Œé»˜è®¤å–å­—æ®µåè¿›è¡Œå®‰è£…åç§°æŸ¥æ‰¾ï¼Œå¦‚æœæ³¨è§£å†™åœ¨setteræ–¹æ³•ä¸Šé»˜è®¤å–å±æ€§åè¿›è¡Œè£…é…ã€‚å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ—¶æ‰æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœnameå±æ€§ä¸€æ—¦æŒ‡å®šï¼Œå°±åªä¼šæŒ‰ç…§åç§°è¿›è¡Œè£…é…ã€‚\r\n4. @AutowiredåªæŒ‰ç…§byTypeæ³¨å…¥,ç”±Springæä¾›ï¼Œ@Resourceé»˜è®¤æŒ‰byNameè‡ªåŠ¨æ³¨å…¥ï¼Œä¹Ÿæä¾›æŒ‰ç…§byTypeæ³¨å…¥\r\n\r\n- [Springæ¢ç´¢ï½œæ—¢ç”Ÿ@Resourceï¼Œä½•ç”Ÿ@Autowiredï¼Ÿ](https://mp.weixin.qq.com/s/MZX97YKKmjuj7FxrjBQ1hg)\r\n- [@Autowiredæ³¨è§£æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ](https://mp.weixin.qq.com/s/gRqZwUV791RtCI1xCoV3Qw)\r\n- [ä½ æ‰€ä¸çŸ¥é“çš„Springä¸­@Autowiredé‚£äº›å®ç°ç»†èŠ‚](https://mp.weixin.qq.com/s/n_syhEFrXykI7ySRtahEmg)\r\n- [@Autowiredçš„è¿™äº›éªšæ“ä½œï¼Œä½ éƒ½çŸ¥é“å—ï¼Ÿ](https://mp.weixin.qq.com/s/2X5xv8I0b6TcXWVH-SC8Ug)\r\n\r\n\r\n**@Inject**\r\n\r\n1. @Injectæ˜¯JSR330(Dependency Injection for Java)ä¸­çš„è§„èŒƒï¼Œéœ€è¦å¯¼å…¥javax.inject.Inject,å®ç°æ³¨å…¥ã€‚\r\n2. @Injectæ˜¯æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named\r\n3. @Injectå¯ä»¥ä½œç”¨åœ¨å˜é‡ã€setteræ–¹æ³•ã€æ„é€ å‡½æ•°ä¸Šã€‚\r\n\r\n```java\r\nprivate Abc abc;\r\n@Inject\r\npublic void setAbc(@Named(\"beanName\") Abc abc){\r\n\tthis.abc = abc;\r\n}\r\n```\r\n\r\n[@Autowired,@Resource,@Injectä¸‰ä¸ªæ³¨è§£çš„åŒºåˆ«](https://mp.weixin.qq.com/s/YLIsRBSiIjz3dCtSA9onDQ)\r\n\r\n1. @Autowiredæ˜¯Springè‡ªå¸¦çš„ï¼Œ@Injectå’Œ@Resourceéƒ½æ˜¯JDKæä¾›çš„ï¼Œå…¶ä¸­@Injectæ˜¯JSR330è§„èŒƒå®ç°çš„ï¼Œ@Resourceæ˜¯JSR250è§„èŒƒå®ç°çš„ï¼Œè€ŒSpringé€šè¿‡BeanPostProcessoræ¥æä¾›å¯¹JDKè§„èŒƒçš„æ”¯æŒã€‚\r\n2. @Autowiredã€@Injectç”¨æ³•åŸºæœ¬ä¸€æ ·ï¼Œä¸åŒä¹‹å¤„ä¸º@Autowiredæœ‰ä¸€ä¸ªrequiredå±æ€§ï¼Œè¡¨ç¤ºè¯¥æ³¨å…¥æ˜¯å¦æ˜¯å¿…é¡»çš„ï¼Œå³å¦‚æœä¸ºå¿…é¡»çš„ï¼Œåˆ™å¦‚æœæ‰¾ä¸åˆ°å¯¹åº”çš„beanï¼Œå°±æ— æ³•æ³¨å…¥ï¼Œæ— æ³•åˆ›å»ºå½“å‰beanã€‚\r\n3. @Autowiredã€@Injectæ˜¯é»˜è®¤æŒ‰ç…§ç±»å‹åŒ¹é…çš„ï¼Œ@Resourceæ˜¯æŒ‰ç…§åç§°åŒ¹é…çš„ã€‚å¦‚åœ¨spring-boot-dataé¡¹ç›®ä¸­è‡ªåŠ¨ç”Ÿæˆçš„redisTemplateçš„beanï¼Œæ˜¯éœ€è¦é€šè¿‡byNameæ¥æ³¨å…¥çš„ã€‚å¦‚æœéœ€è¦æ³¨å…¥è¯¥é»˜è®¤çš„ï¼Œåˆ™éœ€è¦ä½¿ç”¨@Resourceæ¥æ³¨å…¥ï¼Œè€Œä¸æ˜¯@Autowiredã€‚\r\n4. å¯¹äº@Autowireå’Œ@Injectï¼Œå¦‚æœåŒä¸€ç±»å‹å­˜åœ¨å¤šä¸ªbeanå®ä¾‹ï¼Œåˆ™éœ€è¦æŒ‡å®šæ³¨å…¥çš„beanNameã€‚@Autowiredå’Œ@Qualifierä¸€èµ·ä½¿ç”¨ï¼Œ@Injectå’Œ@Namedä¸€èµ·ä½¿ç”¨ã€‚\r\n\r\n\r\n\r\n### Beançš„ä½œç”¨åŸŸæœ‰å“ªäº›?\r\n\r\nSpringä¸­Beançš„ä½œç”¨åŸŸé€šå¸¸æœ‰ä¸‹é¢å‡ ç§ï¼š\r\n\r\n- **singleton**:IoCå®¹å™¨ä¸­åªæœ‰å”¯ä¸€çš„beanå®ä¾‹ã€‚Springä¸­çš„beané»˜è®¤éƒ½æ˜¯å•ä¾‹çš„ï¼Œæ˜¯å¯¹å•ä¾‹è®¾è®¡æ¨¡å¼çš„åº”ç”¨ã€‚\r\n- **prototype**:æ¯æ¬¡è·å–éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„beanå®ä¾‹ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè¿ç»­`getBean()`ä¸¤æ¬¡ï¼Œå¾—åˆ°çš„æ˜¯ä¸åŒçš„Beanå®ä¾‹ã€‚\r\n- **request**ï¼ˆä»…Webåº”ç”¨å¯ç”¨ï¼‰:æ¯ä¸€æ¬¡HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼ˆè¯·æ±‚beanï¼‰ï¼Œè¯¥beanä»…åœ¨å½“å‰HTTPrequestå†…æœ‰æ•ˆã€‚\r\n- **session**ï¼ˆä»…Webåº”ç”¨å¯ç”¨ï¼‰:æ¯ä¸€æ¬¡æ¥è‡ªæ–°sessionçš„HTTPè¯·æ±‚éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªæ–°çš„beanï¼ˆä¼šè¯beanï¼‰ï¼Œè¯¥beanä»…åœ¨å½“å‰HTTPsessionå†…æœ‰æ•ˆã€‚\r\n- **application/global-session**ï¼ˆä»…Webåº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸ªWebåº”ç”¨åœ¨å¯åŠ¨æ—¶åˆ›å»ºä¸€ä¸ªBeanï¼ˆåº”ç”¨Beanï¼‰ï¼Œè¯¥beanä»…åœ¨å½“å‰åº”ç”¨å¯åŠ¨æ—¶é—´å†…æœ‰æ•ˆã€‚\r\n- **websocket**ï¼ˆä»…Webåº”ç”¨å¯ç”¨ï¼‰ï¼šæ¯ä¸€æ¬¡WebSocketä¼šè¯äº§ç”Ÿä¸€ä¸ªæ–°çš„beanã€‚\r\n\r\n**å¦‚ä½•é…ç½®beançš„ä½œç”¨åŸŸå‘¢ï¼Ÿ**\r\n\r\nxmlæ–¹å¼ï¼š\r\n\r\n```xml\r\n<bean id=\"...\" class=\"...\" scope=\"singleton\"></bean>\r\n```\r\n\r\næ³¨è§£æ–¹å¼ï¼š\r\n\r\n```java\r\n@Bean\r\n@Scope(value = ConfigurableBeanFactory.SCOPE_PROTOTYPE)\r\npublic Person personPrototype() {\r\n    return new Person();\r\n}\r\n```\r\n\r\n### å•ä¾‹Beançš„çº¿ç¨‹å®‰å…¨é—®é¢˜äº†è§£å—ï¼Ÿ\r\n\r\nå¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨é¡¹ç›®ä¸­ä½¿ç”¨å¤šçº¿ç¨‹ï¼Œæ‰€ä»¥å¾ˆå°‘æœ‰äººä¼šå…³æ³¨è¿™ä¸ªé—®é¢˜ã€‚å•ä¾‹Beanå­˜åœ¨çº¿ç¨‹é—®é¢˜ï¼Œä¸»è¦æ˜¯å› ä¸ºå½“å¤šä¸ªçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™æ˜¯å­˜åœ¨èµ„æºç«äº‰çš„ã€‚\r\n\r\nå¸¸è§çš„æœ‰ä¸¤ç§è§£å†³åŠæ³•ï¼š\r\n\r\n1. åœ¨Beanä¸­å°½é‡é¿å…å®šä¹‰å¯å˜çš„æˆå‘˜å˜é‡ã€‚\r\n2. åœ¨ç±»ä¸­å®šä¹‰ä¸€ä¸ªThreadLocalæˆå‘˜å˜é‡ï¼Œå°†éœ€è¦çš„å¯å˜æˆå‘˜å˜é‡ä¿å­˜åœ¨ThreadLocalä¸­ï¼ˆæ¨èçš„ä¸€ç§æ–¹å¼ï¼‰ã€‚\r\n\r\nä¸è¿‡ï¼Œå¤§éƒ¨åˆ†Beanå®é™…éƒ½æ˜¯æ— çŠ¶æ€ï¼ˆæ²¡æœ‰å®ä¾‹å˜é‡ï¼‰çš„ï¼ˆæ¯”å¦‚Daoã€Serviceï¼‰ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼ŒBeanæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚\r\n\r\n### Beançš„ç”Ÿå‘½å‘¨æœŸ(è¯¦ç»†ä»‹ç»è§ä¸‹ç« )\r\n\r\n> ä¸‹é¢çš„å†…å®¹æ•´ç†è‡ªï¼š[https://yemengying.com/2016/07/14/spring-bean-life-cycle/](https://yemengying.com/2016/07/14/spring-bean-life-cycle/)ï¼Œé™¤äº†è¿™ç¯‡æ–‡ç« ï¼Œå†æ¨èä¸€ç¯‡å¾ˆä¸é”™çš„æ–‡ç« ï¼š[https://www.cnblogs.com/zrtqsk/p/3735273.html](https://www.cnblogs.com/zrtqsk/p/3735273.html)ã€‚\r\n\r\n- Beanå®¹å™¨æ‰¾åˆ°é…ç½®æ–‡ä»¶ä¸­Spring Beançš„å®šä¹‰ã€‚\r\n- Beanå®¹å™¨åˆ©ç”¨Java Reflection APIåˆ›å»ºä¸€ä¸ªBeançš„å®ä¾‹ã€‚\r\n- å¦‚æœæ¶‰åŠåˆ°ä¸€äº›å±æ€§å€¼åˆ©ç”¨set()æ–¹æ³•è®¾ç½®ä¸€äº›å±æ€§å€¼ã€‚\r\n- å¦‚æœBeanå®ç°äº†BeanNameAwareæ¥å£ï¼Œè°ƒç”¨setBeanName()æ–¹æ³•ï¼Œä¼ å…¥Beançš„åå­—ã€‚\r\n- å¦‚æœBeanå®ç°äº†BeanClassLoaderAwareæ¥å£ï¼Œè°ƒç”¨setBeanClassLoader()æ–¹æ³•ï¼Œä¼ å…¥ClassLoaderå¯¹è±¡çš„å®ä¾‹ã€‚\r\n- å¦‚æœBeanå®ç°äº†BeanFactoryAwareæ¥å£ï¼Œè°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œä¼ å…¥BeanFactoryå¯¹è±¡çš„å®ä¾‹ã€‚\r\n- ä¸ä¸Šé¢çš„ç±»ä¼¼ï¼Œå¦‚æœå®ç°äº†å…¶ä»–*.Awareæ¥å£ï¼Œå°±è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚\r\n- å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ªBeançš„Springå®¹å™¨ç›¸å…³çš„BeanPostProcessorå¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessBeforeInitialization()æ–¹æ³•\r\n- å¦‚æœBeanå®ç°äº†InitializingBeanæ¥å£ï¼Œæ‰§è¡ŒafterPropertiesSet()æ–¹æ³•ã€‚\r\n- å¦‚æœBeanåœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å«init-methodå±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚\r\n- å¦‚æœæœ‰å’ŒåŠ è½½è¿™ä¸ªBeançš„Springå®¹å™¨ç›¸å…³çš„BeanPostProcessorå¯¹è±¡ï¼Œæ‰§è¡ŒpostProcessAfterInitialization()æ–¹æ³•\r\n- å½“è¦é”€æ¯Beançš„æ—¶å€™ï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œæ‰§è¡Œdestroy()æ–¹æ³•ã€‚\r\n- å½“è¦é”€æ¯Beançš„æ—¶å€™ï¼Œå¦‚æœBeanåœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰åŒ…å«destroy-methodå±æ€§ï¼Œæ‰§è¡ŒæŒ‡å®šçš„æ–¹æ³•ã€‚\r\n\r\nå›¾ç¤ºï¼š\r\n![Spring Beanç”Ÿå‘½å‘¨æœŸ](https://images.xiaozhuanlan.com/photo/2019/24bc2bad3ce28144d60d9e0a2edf6c7f.jpg)\r\n\r\nä¸ä¹‹æ¯”è¾ƒç±»ä¼¼çš„ä¸­æ–‡ç‰ˆæœ¬:\r\n\r\n![Spring Beanç”Ÿå‘½å‘¨æœŸ](https://images.xiaozhuanlan.com/photo/2019/b5d264565657a5395c2781081a7483e1.jpg)\r\n\r\n\r\n\r\n## Spring Beanç”Ÿå‘½å‘¨æœŸ\r\n\r\n### ä¸€ã€è·å–Bean\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPYhVDaaP8cNKOLWfufL5rQXaMa7xPp4N8NAI2162lm2Rrwvl8sibVCjg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n#### ç¬¬ä¸€é˜¶æ®µè·å–Bean\r\n\r\nè¿™é‡Œçš„æµç¨‹å›¾çš„å…¥å£åœ¨`AbstractBeanFactory`ç±»çš„`doGetBean`æ–¹æ³•ï¼Œè¿™é‡Œå¯ä»¥é…åˆå‰é¢çš„getBeanæ–¹æ³•åˆ†ææ–‡ç« è¿›è¡Œé˜…è¯»ã€‚ä¸»è¦æµç¨‹å°±æ˜¯\r\n**1ã€**å…ˆå¤„ç†Beançš„åç§°ï¼Œå› ä¸ºå¦‚æœä»¥â€œ&â€å¼€å¤´çš„Beanåç§°è¡¨ç¤ºè·å–çš„æ˜¯å¯¹åº”çš„FactoryBeanå¯¹è±¡\r\n**2ã€**ä»ç¼“å­˜ä¸­è·å–å•ä¾‹Beanï¼Œæœ‰åˆ™è¿›ä¸€æ­¥åˆ¤æ–­è¿™ä¸ªBeanæ˜¯ä¸æ˜¯åœ¨åˆ›å»ºä¸­ï¼Œå¦‚æœæ˜¯çš„å°±ç­‰å¾…åˆ›å»ºå®Œæ¯•ï¼Œå¦åˆ™ç›´æ¥è¿”å›è¿™ä¸ªBeanå¯¹è±¡\r\n**3ã€**å¦‚æœä¸å­˜åœ¨å•ä¾‹Beanç¼“å­˜ï¼Œåˆ™å…ˆè¿›è¡Œå¾ªç¯ä¾èµ–çš„è§£æ\r\n**4ã€**è§£æå®Œæ¯•ä¹‹åå…ˆè·å–çˆ¶ç±»BeanFactoryï¼Œè·å–åˆ°äº†åˆ™è°ƒç”¨çˆ¶ç±»çš„getBeanæ–¹æ³•ï¼Œä¸å­˜åœ¨åˆ™å…ˆåˆå¹¶ç„¶ååˆ›å»ºBean\r\n\r\n### äºŒã€åˆ›å»ºBean\r\n\r\n#### 2.1 åˆ›å»ºBeanä¹‹å‰\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPicgybuOPvUicWBAxrM1rT0PhJeZ1ftRibJGWGYM7P0f5XMga9QCrSlFFQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**åœ¨çœŸæ­£åˆ›å»ºBeanä¹‹å‰é€»è¾‘**\r\nè¿™ä¸ªæµç¨‹å›¾å¯¹åº”çš„ä»£ç åœ¨`AbstractAutowireCapableBeanFactory`ç±»çš„`createBean`æ–¹æ³•ä¸­ã€‚\r\n**1ã€**è¿™é‡Œä¼šå…ˆè·å–`RootBeanDefinition`å¯¹è±¡ä¸­çš„Classå¯¹è±¡å¹¶ç¡®ä¿å·²ç»å…³è”äº†è¦åˆ›å»ºçš„Beançš„Classã€‚\r\n**2ã€**è¿™é‡Œä¼šæ£€æŸ¥3ä¸ªæ¡ä»¶\r\nï¼ˆ1ï¼‰Beançš„å±æ€§ä¸­çš„`beforeInstantiationResolved`å­—æ®µæ˜¯å¦ä¸ºtrueï¼Œé»˜è®¤æ˜¯falseã€‚\r\nï¼ˆ2ï¼‰Beanæ˜¯åŸç”Ÿçš„Bean\r\nï¼ˆ3ï¼‰Beançš„`hasInstantiationAwareBeanPostProcessors`å±æ€§ä¸ºtrueï¼Œè¿™ä¸ªå±æ€§åœ¨Springå‡†å¤‡åˆ·æ–°å®¹å™¨BeanPostProcessorsçš„æ—¶å€™ä¼šè®¾ç½®ï¼Œå¦‚æœå½“å‰Beanå®ç°äº†`InstantiationAwareBeanPostProcessor`åˆ™è¿™ä¸ªå°±ä¼šæ˜¯trueã€‚\r\n\r\nå½“ä¸‰ä¸ªæ¡ä»¶éƒ½å­˜åœ¨çš„æ—¶å€™ï¼Œå°±ä¼šè°ƒç”¨å®ç°çš„`InstantiationAwareBeanPostProcessor`æ¥å£çš„`postProcessBeforeInstantiation`æ–¹æ³•ï¼Œç„¶åè·å–è¿”å›çš„Beanï¼Œå¦‚æœè¿”å›çš„Beanä¸æ˜¯nullè¿˜ä¼šè°ƒç”¨å®ç°çš„`BeanPostProcessor`æ¥å£çš„`postProcessAfterInitialization`æ–¹æ³•ï¼Œè¿™é‡Œç”¨ä»£ç è¯´æ˜\r\n\r\n```java\r\nprotected Object resolveBeforeInstantiation(String beanName, RootBeanDefinition mbd) {\r\n        Object bean = null;\r\n        //æ¡ä»¶1\r\n        if (!Boolean.FALSE.equals(mbd.beforeInstantiationResolved)) {\r\n            //æ¡ä»¶2è·Ÿæ¡ä»¶3\r\n            if (!mbd.isSynthetic() && hasInstantiationAwareBeanPostProcessors()) {\r\n                Class<?> targetType = determineTargetType(beanName, mbd);\r\n                if (targetType != null) {\r\n                    //è°ƒç”¨å®ç°çš„postProcessBeforeInstantiationæ–¹æ³•\r\n                    bean = applyBeanPostProcessorsBeforeInstantiation(targetType, beanName);\r\n                    if (bean != null) {\r\n                       //è°ƒç”¨å®ç°çš„postProcessAfterInitializationæ–¹æ³•\r\n                        bean = applyBeanPostProcessorsAfterInitialization(bean, beanName);\r\n                    }\r\n                }\r\n            }\r\n            //ä¸æ»¡è¶³2æˆ–è€…3çš„æ—¶å€™å°±ä¼šè®¾ç½®ä¸ºfalse\r\n            mbd.beforeInstantiationResolved = (bean != null);\r\n        }\r\n        return bean;\r\n    }\r\n```\r\n\r\n**3ã€**å¦‚æœä¸Šé¢3ä¸ªæ¡ä»¶å…¶ä¸­ä¸€ä¸ªä¸æ»¡è¶³å°±ä¸ä¼šè°ƒç”¨å®ç°çš„æ–¹æ³•ã€‚é»˜è®¤è¿™é‡Œéƒ½ä¸ä¼šè°ƒç”¨çš„è¿™äº›`BeanPostProcessors`çš„å®ç°æ–¹æ³•ã€‚ç„¶åç»§ç»­æ‰§è¡Œåé¢çš„`doCreateBean`æ–¹æ³•ã€‚\r\n\r\n#### 2.2 çœŸæ­£çš„åˆ›å»ºBeanï¼ŒdoCreateBean\r\n\r\n![](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPIhTibribNrjwS7O5fH8doMAibkvl5icWLeq16ibP52JcxspfB8nDtyMhKQA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**doCreateBeanæ–¹æ³•é€»è¾‘**\r\nè¿™ä¸ªä»£ç çš„å®ç°è¿˜æ˜¯åœ¨`AbstractAutowireCapableBeanFactory`æ–¹æ³•ä¸­ã€‚æµç¨‹æ˜¯\r\n**1ã€**å…ˆæ£€æŸ¥`instanceWrapper`å˜é‡æ˜¯ä¸æ˜¯nullï¼Œè¿™é‡Œä¸€èˆ¬æ˜¯nullï¼Œé™¤éå½“å‰æ­£åœ¨åˆ›å»ºçš„Beanåœ¨`factoryBeanInstanceCache`ä¸­å­˜åœ¨è¿™ä¸ªæ˜¯ä¿å­˜è¿˜æ²¡åˆ›å»ºå®Œæˆçš„FactoryBeançš„é›†åˆã€‚\r\n**2ã€**è°ƒç”¨createBeanInstanceæ–¹æ³•å®ä¾‹åŒ–Beanï¼Œè¿™ä¸ªæ–¹æ³•åœ¨åé¢ä¼šè®²è§£\r\n**3ã€**å¦‚æœå½“å‰`RootBeanDefinition`å¯¹è±¡è¿˜æ²¡æœ‰è°ƒç”¨è¿‡å®ç°äº†çš„`MergedBeanDefinitionPostProcessor`æ¥å£çš„æ–¹æ³•ï¼Œåˆ™ä¼šè¿›è¡Œè°ƒç”¨ã€‚\r\n**4**ã€å½“æ»¡è¶³ä»¥ä¸‹ä¸‰ç‚¹\r\nï¼ˆ1ï¼‰æ˜¯å•ä¾‹Bean\r\nï¼ˆ2ï¼‰å°è¯•è§£æbeanä¹‹é—´çš„å¾ªç¯å¼•ç”¨\r\nï¼ˆ3ï¼‰beanç›®å‰æ­£åœ¨åˆ›å»ºä¸­\r\nåˆ™ä¼šè¿›ä¸€æ­¥æ£€æŸ¥æ˜¯å¦å®ç°äº†`SmartInstantiationAwareBeanPostProcessor`æ¥å£å¦‚æœå®ç°äº†åˆ™è°ƒç”¨æ˜¯å®ç°çš„`getEarlyBeanReference`æ–¹æ³•\r\n**5ã€**è°ƒç”¨`populateBean`æ–¹æ³•è¿›è¡Œå±æ€§å¡«å……ï¼Œè¿™é‡Œåé¢ä¼šè®²è§£\r\n**6ã€**è°ƒç”¨`initializeBean`æ–¹æ³•å¯¹Beanè¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™é‡Œåé¢ä¼šè®²è§£\r\n\r\n##### 2.2.1 å®ä¾‹åŒ–Beanï¼ŒcreateBeanInstance\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpP4WkTkskaiaq1XKqJAEKWhLeNicuTJSsicuK7licC9doicxAbdr01YF0taQg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**å®ä¾‹åŒ–Bean**\r\n\r\nè¿™é‡Œçš„é€»è¾‘ç¨å¾®æœ‰ä¸€ç‚¹å¤æ‚ï¼Œè¿™ä¸ªæµç¨‹å›¾å·²ç»æ˜¯ç®€åŒ–è¿‡åçš„äº†ã€‚ç®€è¦æ ¹æ®ä»£ç è¯´æ˜ä¸€ä¸‹æµç¨‹\r\n\r\n```java\r\n    protected BeanWrapper createBeanInstance(String beanName, RootBeanDefinition mbd, @Nullable Object[] args) {\r\n        //æ­¥éª¤1\r\n        Class<?> beanClass = resolveBeanClass(mbd, beanName);\r\n\r\n        if (beanClass != null && !Modifier.isPublic(beanClass.getModifiers()) && !mbd.isNonPublicAccessAllowed()) {\r\n            throw new BeanCreationException(mbd.getResourceDescription(), beanName,\r\n                    \"Bean class isn't public, and non-public access not allowed: \" + beanClass.getName());\r\n        }\r\n        //æ­¥éª¤2\r\n        Supplier<?> instanceSupplier = mbd.getInstanceSupplier();\r\n        if (instanceSupplier != null) {\r\n            return obtainFromSupplier(instanceSupplier, beanName);\r\n        }\r\n        //æ­¥éª¤3\r\n        if (mbd.getFactoryMethodName() != null) {\r\n            return instantiateUsingFactoryMethod(beanName, mbd, args);\r\n        }\r\n        boolean resolved = false;\r\n        boolean autowireNecessary = false;\r\n        if (args == null) {\r\n            synchronized (mbd.constructorArgumentLock) {\r\n                if (mbd.resolvedConstructorOrFactoryMethod != null) {\r\n                    resolved = true;\r\n                    autowireNecessary = mbd.constructorArgumentsResolved;\r\n                }\r\n            }\r\n        }\r\n        //æ­¥éª¤4.1\r\n        if (resolved) {\r\n            if (autowireNecessary) {\r\n                return autowireConstructor(beanName, mbd, null, null);\r\n            }\r\n            else {\r\n                return instantiateBean(beanName, mbd);\r\n            }\r\n        }\r\n\r\n          //æ­¥éª¤4.2\r\n        Constructor<?>[] ctors = determineConstructorsFromBeanPostProcessors(beanClass, beanName);\r\n        if (ctors != null || mbd.getResolvedAutowireMode() == AUTOWIRE_CONSTRUCTOR ||\r\n                mbd.hasConstructorArgumentValues() || !ObjectUtils.isEmpty(args)) {\r\n            return autowireConstructor(beanName, mbd, ctors, args);\r\n        }\r\n        //æ­¥éª¤5\r\n        ctors = mbd.getPreferredConstructors();\r\n        if (ctors != null) {\r\n            return autowireConstructor(beanName, mbd, ctors, null);\r\n        }\r\n        return instantiateBean(beanName, mbd);\r\n    }\r\n```\r\n\r\n**1ã€**å…ˆæ£€æŸ¥Classæ˜¯å¦å·²ç»å…³è”äº†ï¼Œå¹¶ä¸”å¯¹åº”çš„ä¿®é¥°ç¬¦æ˜¯å¦æ˜¯publicçš„\r\n**2ã€**å¦‚æœç”¨æˆ·å®šä¹‰äº†Beanå®ä¾‹åŒ–çš„å‡½æ•°ï¼Œåˆ™è°ƒç”¨å¹¶è¿”å›\r\n**3ã€**å¦‚æœå½“å‰Beanå®ç°äº†`FactoryBean`æ¥å£åˆ™è°ƒç”¨å¯¹åº”çš„`FactoryBean`æ¥å£çš„`getObject`æ–¹æ³•\r\n**4ã€**æ ¹æ®getBeanæ—¶å€™æ˜¯å¦ä¼ å…¥æ„é€ å‚æ•°è¿›è¡Œå¤„ç†\r\n**4.1**å¦‚æœæ²¡æœ‰ä¼ å…¥æ„é€ å‚æ•°ï¼Œåˆ™æ£€æŸ¥æ˜¯å¦å­˜åœ¨å·²ç»ç¼“å­˜çš„æ— å‚æ„é€ å™¨ï¼Œæœ‰åˆ™ä½¿ç”¨æ„é€ å™¨ç›´æ¥åˆ›å»ºï¼Œæ²¡æœ‰å°±ä¼šè°ƒç”¨`instantiateBean`æ–¹æ³•å…ˆè·å–å®ä¾‹åŒ–çš„ç­–ç•¥é»˜è®¤æ˜¯`CglibSubclassingInstantiationStrategy`ï¼Œç„¶åå®ä¾‹åŒ–Beanã€‚æœ€åè¿”å›\r\n**4.2**å¦‚æœä¼ å…¥äº†æ„é€ å‚æ•°ï¼Œåˆ™ä¼šå…ˆæ£€æŸ¥æ˜¯å¦å®ç°äº†`SmartInstantiationAwareBeanPostProcessor`æ¥å£ï¼Œå¦‚æœå®ç°äº†ä¼šè°ƒç”¨`determineCandidateConstructors`è·å–è¿”å›çš„å€™é€‰æ„é€ å™¨ã€‚\r\n**4.3**æ£€æŸ¥4ä¸ªæ¡ä»¶æ˜¯å¦æ»¡è¶³ä¸€ä¸ª\r\nï¼ˆ1ï¼‰æ„é€ å™¨ä¸ä¸ºnullï¼Œ\r\nï¼ˆ2ï¼‰ä»RootBeanDefinitionä¸­è·å–åˆ°çš„å…³è”çš„æ³¨å…¥æ–¹å¼æ˜¯æ„é€ å™¨æ³¨å…¥ï¼ˆæ²¡æœ‰æ„é€ å‚æ•°å°±æ˜¯setteræ³¨å…¥ï¼Œæœ‰åˆ™æ˜¯æ„é€ å™¨æ³¨å…¥ï¼‰\r\nï¼ˆ3ï¼‰å«æœ‰æ„é€ å‚æ•°\r\nï¼ˆ4ï¼‰getBeanæ–¹æ³•ä¼ å…¥æ„é€ å‚æ•°ä¸æ˜¯ç©º\r\næ»¡è¶³å…¶ä¸­ä¸€ä¸ªåˆ™ä¼šè°ƒç”¨è¿”å›çš„å€™é€‰æ„é€ å™¨å®ä¾‹åŒ–Beanå¹¶è¿”å›ï¼Œå¦‚æœéƒ½ä¸æ»¡è¶³ï¼Œåˆ™ä¼šæ ¹æ®æ„é€ å‚æ•°é€‰åˆ™åˆé€‚çš„æœ‰å‚æ„é€ å™¨ç„¶åå®ä¾‹åŒ–Beanå¹¶è¿”å›\r\n**5ã€**å¦‚æœä¸Šé¢éƒ½æ²¡æœ‰åˆé€‚çš„æ„é€ å™¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨æ— å‚æ„é€ å™¨åˆ›å»ºå¹¶è¿”å›Beanã€‚\r\n\r\n##### 2.2.2 å¡«å……Beanï¼ŒpopulateBean\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPRaNrWofKRqgPdvMFQn03uicb2NmqJCHcRzncyuoobJ7alPiaOpVPGR8g/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**å¡«å……Bean**\r\nè¿™é‡Œè¿˜æ˜¯æ ¹æ®ä»£ç æ¥è¯´ä¸€ä¸‹æµç¨‹\r\n\r\n```java\r\n    protected void populateBean(String beanName, RootBeanDefinition mbd, @Nullable BeanWrapper bw) {\r\n        if (bw == null) {\r\n            if (mbd.hasPropertyValues()) {\r\n                throw new BeanCreationException(\r\n                        mbd.getResourceDescription(), beanName, \"Cannot apply property values to null instance\");\r\n            }\r\n            else {\r\n                // Skip property population phase for null instance.\r\n                return;\r\n            }\r\n        }\r\n        boolean continueWithPropertyPopulation = true;\r\n        //æ­¥éª¤1\r\n        if (!mbd.isSynthetic() && hasInstantiationAwareBeanPostProcessors()) {\r\n            for (BeanPostProcessor bp : getBeanPostProcessors()) {\r\n                if (bp instanceof InstantiationAwareBeanPostProcessor) {\r\n                    InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;\r\n                    if (!ibp.postProcessAfterInstantiation(bw.getWrappedInstance(), beanName)) {\r\n                        continueWithPropertyPopulation = false;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        if (!continueWithPropertyPopulation) {\r\n            return;\r\n        }\r\n        //æ­¥éª¤2--------------------\r\n        PropertyValues pvs = (mbd.hasPropertyValues() ? mbd.getPropertyValues() : null);\r\n\r\n        int resolvedAutowireMode = mbd.getResolvedAutowireMode();\r\n        if (resolvedAutowireMode == AUTOWIRE_BY_NAME || resolvedAutowireMode == AUTOWIRE_BY_TYPE) {\r\n            MutablePropertyValues newPvs = new MutablePropertyValues(pvs);\r\n            // Add property values based on autowire by name if applicable.\r\n            if (resolvedAutowireMode == AUTOWIRE_BY_NAME) {\r\n                autowireByName(beanName, mbd, bw, newPvs);\r\n            }\r\n            // Add property values based on autowire by type if applicable.\r\n            if (resolvedAutowireMode == AUTOWIRE_BY_TYPE) {\r\n                autowireByType(beanName, mbd, bw, newPvs);\r\n            }\r\n            pvs = newPvs;\r\n        }\r\n\r\n        boolean hasInstAwareBpps = hasInstantiationAwareBeanPostProcessors();\r\n        boolean needsDepCheck = (mbd.getDependencyCheck() != AbstractBeanDefinition.DEPENDENCY_CHECK_NONE);\r\n\r\n        PropertyDescriptor[] filteredPds = null;\r\n        //æ­¥éª¤3\r\n        if (hasInstAwareBpps) {\r\n            if (pvs == null) {\r\n                pvs = mbd.getPropertyValues();\r\n            }\r\n            for (BeanPostProcessor bp : getBeanPostProcessors()) {\r\n                if (bp instanceof InstantiationAwareBeanPostProcessor) {\r\n                    InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp;\r\n                    PropertyValues pvsToUse = ibp.postProcessProperties(pvs, bw.getWrappedInstance(), beanName);\r\n                    if (pvsToUse == null) {\r\n                        if (filteredPds == null) {\r\n                            filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);\r\n                        }\r\n                        pvsToUse = ibp.postProcessPropertyValues(pvs, filteredPds, bw.getWrappedInstance(), beanName);\r\n                        if (pvsToUse == null) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    pvs = pvsToUse;\r\n                }\r\n            }\r\n        }\r\n        if (needsDepCheck) {\r\n            if (filteredPds == null) {\r\n                filteredPds = filterPropertyDescriptorsForDependencyCheck(bw, mbd.allowCaching);\r\n            }\r\n            checkDependencies(beanName, mbd, filteredPds, pvs);\r\n        }\r\n        //æ­¥éª¤4\r\n        if (pvs != null) {\r\n            applyPropertyValues(beanName, mbd, bw, pvs);\r\n        }\r\n    }\r\n```\r\n\r\n**1ã€**æ£€æŸ¥å½“å‰Beanæ˜¯å¦å®ç°äº†`InstantiationAwareBeanPostProcessor`çš„`postProcessAfterInstantiation`æ–¹æ³•åˆ™è°ƒç”¨ï¼Œå¹¶ç»“æŸBeançš„å¡«å……ã€‚\r\n**2ã€**å°†æŒ‰ç…§ç±»å‹è·ŸæŒ‰ç…§åç§°æ³¨å…¥çš„Beanåˆ†å¼€ï¼Œå¦‚æœæ³¨å…¥çš„Beanè¿˜æ²¡æœ‰å®ä¾‹åŒ–çš„è¿™é‡Œä¼šå®ä¾‹åŒ–ï¼Œç„¶åæ”¾åˆ°`PropertyValues`å¯¹è±¡ä¸­ã€‚\r\n**3ã€**å¦‚æœå®ç°äº†`InstantiationAwareBeanPostProcessor`ç±»çš„`postProcessProperties`åˆ™è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¹¶è·å–è¿”å›å€¼ï¼Œå¦‚æœè¿”å›å€¼æ˜¯nullï¼Œåˆ™æœ‰å¯èƒ½æ˜¯å®ç°äº†è¿‡æœŸçš„`postProcessPropertyValues`æ–¹æ³•ï¼Œè¿™é‡Œéœ€è¦è¿›ä¸€æ­¥è°ƒç”¨`postProcessPropertyValues`æ–¹æ³•\r\n**4ã€**è¿›è¡Œå‚æ•°å¡«å……\r\n\r\n##### 2.2.3 åˆå§‹åŒ–Beanï¼ŒinitializeBean\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPZjJibwdUibfEibHoFzlWI6yFbIlaG2EvckACOCY5mneiaibpOZfZrtQICibw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**åˆå§‹åŒ–Bean**\r\nåŒæ—¶è¿™é‡Œæ ¹æ®ä»£ç è·Ÿæµç¨‹å›¾æ¥è¯´æ˜\r\n\r\n**1ã€**å¦‚æœBeanå®ç°äº†`BeanNameAware`,`BeanClassLoaderAware`,`BeanFactoryAware`åˆ™è°ƒç”¨å¯¹åº”å®ç°çš„æ–¹æ³•ã€‚\r\n**2ã€**Beanä¸ä¸ºnullå¹¶ä¸”beanä¸æ˜¯åˆæˆçš„ï¼Œå¦‚æœå®ç°äº†`BeanPostProcessor`çš„`postProcessBeforeInitialization`åˆ™ä¼šè°ƒç”¨å®ç°çš„`postProcessBeforeInitialization`æ–¹æ³•ã€‚åœ¨`ApplicationContextAwareProcessor`ç±»ä¸­å®ç°äº†`postProcessBeforeInitialization`æ–¹æ³•ã€‚è€Œè¿™ä¸ªç±»ä¼šåœ¨Springåˆ·æ–°å®¹å™¨å‡†å¤‡`beanFactory`çš„æ—¶å€™ä¼šåŠ è¿›å»ï¼Œè¿™é‡Œå°±ä¼šè¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨é‡Œé¢ä¼šæ£€æŸ¥Beanæ˜¯ä¸æ˜¯`EnvironmentAware`,`EmbeddedValueResolverAware`,`ResourceLoaderAware`,`ApplicationEventPublisherAware`,`MessageSourceAware`,`ApplicationContextAware`çš„å®ç°ç±»ã€‚è¿™é‡Œå°±ä¼šè°ƒç”¨å¯¹åº”çš„å®ç°æ–¹æ³•ã€‚ä»£ç å¦‚ä¸‹\r\n\r\n```java\r\n    protected void prepareBeanFactory(ConfigurableListableBeanFactory beanFactory) {\r\n        .......\r\n        beanFactory.addBeanPostProcessor(new ApplicationContextAwareProcessor(this));\r\n        .......\r\n    public Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {\r\n        if (!(bean instanceof EnvironmentAware || bean instanceof EmbeddedValueResolverAware ||\r\n                bean instanceof ResourceLoaderAware || bean instanceof ApplicationEventPublisherAware ||\r\n                bean instanceof MessageSourceAware || bean instanceof ApplicationContextAware)){\r\n            return bean;\r\n        }\r\n\r\n        AccessControlContext acc = null;\r\n\r\n        if (System.getSecurityManager() != null) {\r\n            acc = this.applicationContext.getBeanFactory().getAccessControlContext();\r\n        }\r\n\r\n        if (acc != null) {\r\n            AccessController.doPrivileged((PrivilegedAction<Object>) () -> {\r\n                invokeAwareInterfaces(bean);\r\n                return null;\r\n            }, acc);\r\n        }\r\n        else {\r\n            invokeAwareInterfaces(bean);\r\n        }\r\n\r\n        return bean;\r\n    }\r\n```\r\n\r\n**1ã€**å®ä¾‹åŒ–Beanç„¶åï¼Œæ£€æŸ¥æ˜¯å¦å®ç°äº†`InitializingBean`çš„`afterPropertiesSet`æ–¹æ³•ï¼Œå¦‚æœå®ç°äº†å°±ä¼šè°ƒç”¨\r\n**2ã€**Beanä¸ä¸ºnullå¹¶ä¸”beanä¸æ˜¯åˆæˆçš„ï¼Œå¦‚æœå®ç°äº†`BeanPostProcessor`çš„`postProcessBeforeInitialization`åˆ™ä¼šè°ƒç”¨å®ç°çš„`postProcessAfterInitialization`æ–¹æ³•ã€‚\r\n\r\nåˆ°æ­¤åˆ›å»ºBeançš„æµç¨‹å°±æ²¡äº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯å®¹å™¨é”€æ¯çš„æ—¶å€™çš„äº†\r\n\r\n### ä¸‰ã€destoryæ–¹æ³•è·Ÿé”€æ¯Bean\r\n\r\nBeanåœ¨åˆ›å»ºå®Œæ¯•ä¹‹åä¼šæ£€æŸ¥ç”¨æˆ·æ˜¯å¦æŒ‡å®šäº†`destroyMethodName`ä»¥åŠæ˜¯å¦å®ç°äº†`DestructionAwareBeanPostProcessor`æ¥å£çš„`requiresDestruction`æ–¹æ³•ï¼Œå¦‚æœæŒ‡å®šäº†ä¼šè®°å½•ä¸‹æ¥ä¿å­˜åœ¨`DisposableBeanAdapter`å¯¹è±¡ä¸­å¹¶ä¿å­˜åœ¨beançš„`disposableBeans`å±æ€§ä¸­ã€‚ä»£ç åœ¨`AbstractBeanFactory`çš„`registerDisposableBeanIfNecessary`ä¸­\r\n\r\n```java\r\n    protected void registerDisposableBeanIfNecessary(String beanName, Object bean, RootBeanDefinition mbd) {\r\n          ......\r\n                registerDisposableBean(beanName,\r\n                        new DisposableBeanAdapter(bean, beanName, mbd, getBeanPostProcessors(), acc));\r\n            ......\r\n    }\r\npublic DisposableBeanAdapter(Object bean, String beanName, RootBeanDefinition beanDefinition,\r\n            List<BeanPostProcessor> postProcessors, @Nullable AccessControlContext acc) {\r\n          .......\r\n        String destroyMethodName = inferDestroyMethodIfNecessary(bean, beanDefinition);\r\n        if (destroyMethodName != null && !(this.invokeDisposableBean && \"destroy\".equals(destroyMethodName)) &&\r\n                !beanDefinition.isExternallyManagedDestroyMethod(destroyMethodName)) {\r\n            ......\r\n            this.destroyMethod = destroyMethod;\r\n        }\r\n        this.beanPostProcessors = filterPostProcessors(postProcessors, bean);\r\n    }\r\n```\r\n\r\nåœ¨é”€æ¯Beançš„æ—¶å€™æœ€åéƒ½ä¼šè°ƒç”¨`AbstractAutowireCapableBeanFactory`çš„`destroyBean`æ–¹æ³•ã€‚\r\n\r\n```java\r\n    public void destroyBean(Object existingBean) {\r\n        new DisposableBeanAdapter(existingBean, getBeanPostProcessors(), getAccessControlContext()).destroy();\r\n    }\r\n```\r\n\r\nè¿™é‡Œæ˜¯åˆ›å»ºä¸€ä¸ª`DisposableBeanAdapter`å¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡å®ç°äº†Runnableæ¥å£ï¼Œåœ¨å®ç°çš„`run`æ–¹æ³•ä¸­ä¼šè°ƒç”¨å®ç°çš„`DisposableBean`æ¥å£çš„`destroy`æ–¹æ³•ã€‚å¹¶ä¸”åœ¨åˆ›å»º`DisposableBeanAdapter`å¯¹è±¡çš„æ—¶å€™ä¼šæ ¹æ®ä¼ å…¥çš„beanæ˜¯å¦å®ç°äº†`DisposableBean`æ¥å£æ¥è®¾ç½®`invokeDisposableBean`å˜é‡ï¼Œè¿™ä¸ªå˜é‡è¡¨å®æœ‰æ²¡æœ‰å®ç°`DisposableBean`æ¥å£\r\n\r\n```java\r\n    public DisposableBeanAdapter(Object bean, List<BeanPostProcessor> postProcessors,AccessControlContext acc) {\r\n        Assert.notNull(bean, \"Disposable bean must not be null\");\r\n        this.bean = bean;\r\n        this.beanName = bean.getClass().getName();\r\n        //æ ¹æ®ä¼ å…¥çš„beanæ˜¯å¦å®ç°äº†`DisposableBean`æ¥å£æ¥è®¾ç½®`invokeDisposableBean`å˜é‡\r\n        this.invokeDisposableBean = (this.bean instanceof DisposableBean);\r\n        this.nonPublicAccessAllowed = true;\r\n        this.acc = acc;\r\n        this.beanPostProcessors = filterPostProcessors(postProcessors, bean);\r\n    }\r\n\r\n    public void destroy() {\r\n        ......\r\n        //æ ¹æ®invokeDisposableBeanå†³å®šæ˜¯å¦è°ƒç”¨destroyæ–¹æ³•\r\n        if (this.invokeDisposableBean) {\r\n            if (logger.isTraceEnabled()) {\r\n                logger.trace(\"Invoking destroy() on bean with name '\" + this.beanName + \"'\");\r\n            }\r\n            try {\r\n                if (System.getSecurityManager() != null) {\r\n                    AccessController.doPrivileged((PrivilegedExceptionAction<Object>) () -> {\r\n                        ((DisposableBean) this.bean).destroy();\r\n                        return null;\r\n                    }, this.acc);\r\n                }\r\n                else {\r\n                    ((DisposableBean) this.bean).destroy();\r\n                }\r\n            }\r\n            catch (Throwable ex) {\r\n                String msg = \"Invocation of destroy method failed on bean with name '\" + this.beanName + \"'\";\r\n                if (logger.isDebugEnabled()) {\r\n                    logger.warn(msg, ex);\r\n                }\r\n                else {\r\n                    logger.warn(msg + \": \" + ex);\r\n                }\r\n            }\r\n        }\r\n......\r\n    }\r\n```\r\n\r\n### å››ã€Beançš„åˆå§‹åŒ–å’Œé”€æ¯çš„å‡ ç§æ–¹å¼\r\n\r\n#### åˆå§‹åŒ–\r\n\r\n- å®ç°InitializingBeanæ¥å£,è¦†ç›–å…¶ä¸­çš„afterPropertiesSet()æ–¹æ³•\r\n- å¢åŠ @PostConstructæ³¨è§£\r\n- è‡ªå®šä¹‰initæ–¹æ³•(@Bean(initMethod = \"initMethod\"))\r\næ‰§è¡Œçš„é¡ºåºä¾æ¬¡æ˜¯postConstruct,afterPropertiesSet,initMethod\r\n\r\n#### é”€æ¯\r\n\r\n- å®ç°org.springframework.beans.factory.DisposableBeanæ¥å£ï¼Œè¦†ç›–destroy()æ–¹æ³•\r\n- è‡ªå®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨æ–¹æ³•ä¸Šé¢å¢åŠ @PreDestroyæ³¨è§£\r\n- åœ¨InitServiceImplä¸­å¢åŠ ä¸€ä¸ªè‡ªå®šä¹‰é”€æ¯æ–¹æ³•ï¼Œç„¶ååœ¨é…ç½®ç±»ä¸­å¢åŠ Beançš„destoryMethod\r\næ‰§è¡Œçš„é¡ºåºä¾æ¬¡æ˜¯preDestroy,destroy,destroyMethod\r\n\r\n\r\n### äº”ã€æ€»ç»“\r\n\r\næœ€åæ¥ä¸€ä¸ªå¤§çš„æµç¨‹\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPQu4pzSyprviaBic07GicVGPvAUdAibkFqybnvOfgdzdw1M1iaMtm9qfBLDQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\n\r\n**å®ä¾‹åŒ–å‰çš„å‡†å¤‡é˜¶æ®µ**\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPic9W1CbpBia73nS2WJAGKRMdW9LtwbxG30IqbNT8ibvH5DfqcHO2IueBw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\nå®ä¾‹åŒ–å‰\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPp3ia71rKnC0FeypESdhAFYAqGicz9KP9LeBxaJHKmvMPUDIGrBdBkBiag/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\nå®ä¾‹åŒ–å\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPjfQ5qaic2Ro6hoqhCdoicgiabmkibR518z7vSpXxmibq91FH1XxgHvdet8Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\nåˆå§‹åŒ–å‰\r\n\r\n![å›¾ç‰‡](https://mmbiz.qpic.cn/mmbiz_png/SJm51egHPPGPI5JCBzTotEAS720l5YpPABU277ApFU3EVr8iaHxtFEVvsawgghYyJd7WlJQFwEkQvXoDW2sQEYQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)\r\nåˆå§‹åŒ–å&é”€æ¯\r\n\r\n## Beançš„æ‰©å±•æ¥å£\r\n\r\n### åˆå§‹åŒ–beançš„é¡ºåº\r\nåœ¨å°†ä¸€ä¸ªBeanå¯¹è±¡é…ç½®åœ¨IOCå®¹å™¨ä¸­ä¹‹åï¼Œè¿™ä¸ªBeançš„ç”Ÿå‘½å‘¨æœŸå°±ä¼šäº¤ç”±IOCå®¹å™¨è¿›è¡Œç®¡ç†ã€‚ä¸€èˆ¬æ‹…å½“ç®¡ç†è€…çš„è§’è‰²æ˜¯BeanFactoryæˆ–ApplicationContextã€‚\r\n\r\n```\r\n1. Beançš„åˆ›å»º\r\nåœ¨è§£æIOCå®¹å™¨æ—¶ï¼Œæ ¹æ®è§£æå®¹å™¨çš„å·¥å‚ï¼Œå†³å®šbeançš„åˆå§‹åŒ–æ—¶é—´\r\nBeanFactory-getBean()æ–¹æ³•è°ƒç”¨æ—¶åˆå§‹åŒ–bean\r\nApplicationContext-è§£æiocå®¹å™¨æ—¶åˆå§‹åŒ–bean\r\n2. æ³¨å…¥\r\næ ¹æ®Beanå­å…ƒç´ çš„é…ç½®å®ç°Beanä¹‹é—´çš„è¢«åŠ¨æ³¨å…¥\r\n3. BeanNameAware\r\nå¦‚æœBeanå®ç°äº†è¯¥æ¥å£ï¼Œæ‰§è¡Œå…¶setBeanName(String name)æ–¹æ³•.å‚æ•°nameæ˜¯Beanåœ¨å®¹å™¨ä¸­çš„åç§°,å³XMLé‡Œé¢Beançš„idåç§°\r\n4. BeanFactoryAware\r\nå¦‚æœå®ç°äº†è¯¥æ¥å£ï¼Œæ‰§è¡Œå…¶setBeanFactory(BeanFactory factory)æ–¹æ³•ï¼Œå‚æ•°æ˜¯åˆ›å»ºBeançš„BeanFactoryæœ¬èº«\r\n5. ApplicationContextAware\r\nå¦‚æœè¿™ä¸ªBeanå·²ç»å®ç°äº†è¯¥æ¥å£ï¼Œä¼šè°ƒç”¨setApplicationContext(ApplicationContext)æ–¹æ³•ï¼Œä¼ å…¥Springä¸Šä¸‹æ–‡ï¼ˆåŒæ ·è¿™ä¸ªæ–¹å¼ä¹Ÿå¯ä»¥å®ç°æ­¥éª¤4çš„å†…å®¹ï¼Œä½†æ¯”4æ›´å¥½ï¼Œå› ä¸ºApplicationContextæ˜¯BeanFactoryçš„å­æ¥å£ï¼Œæœ‰æ›´å¤šçš„å®ç°æ–¹æ³•ï¼‰\r\nimport org.springframework.beans.context.ApplicationContextAware\r\n// å½“éœ€è¦ä»Springå®¹å™¨ä¸­è·å–Beanæ—¶ä¸€èˆ¬ä½¿ç”¨è¿™ç§æ–¹å¼è·å–\r\nApplicationContext appContext = new ClassPathXmlApplicationContext(\"applicationContext-common.xml\");\r\nAbcService abcService = (AbcService)appContext.getBean(\"abcService\");\r\n// ä½†æ˜¯è¿™æ ·å°±ä¼šå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šå› ä¸ºå®ƒä¼šé‡æ–°è£…è½½applicationContext-common.xmlå¹¶å®ä¾‹åŒ–ä¸Šä¸‹æ–‡Beanï¼Œå¦‚æœæœ‰äº›çº¿ç¨‹é…ç½®ç±»ä¹Ÿæ˜¯åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œé‚£ä¹ˆä¼šé€ æˆåšç›¸åŒå·¥ä½œçš„çš„çº¿ç¨‹ä¼šè¢«å¯ä¸¤æ¬¡ã€‚ä¸€æ¬¡æ˜¯webå®¹å™¨åˆå§‹åŒ–æ—¶å¯åŠ¨ï¼Œå¦ä¸€æ¬¡æ˜¯ä¸Šè¿°ä»£ç æ˜¾ç¤ºçš„å®ä¾‹åŒ–äº†ä¸€æ¬¡ã€‚å½“äºé‡æ–°åˆå§‹åŒ–ä¸€éï¼è¿™æ ·å°±äº§ç”Ÿäº†å†—ä½™,æ‰€ä»¥å¯ä»¥é€šè¿‡å®ç°ApplicationContextAwareæ¥å£è·å–Bean,å½“ä¸€ä¸ªç±»å®ç°äº†è¿™ä¸ªæ¥å£ï¼ˆApplicationContextAwareï¼‰ä¹‹åï¼Œè¿™ä¸ªç±»å°±å¯ä»¥æ–¹ä¾¿è·å¾—ApplicationContextä¸­çš„æ‰€æœ‰Beanã€‚æ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¿™ä¸ªç±»å¯ä»¥ç›´æ¥è·å–Springé…ç½®æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰æœ‰å¼•ç”¨åˆ°çš„Beanå¯¹è±¡\r\n\r\nprivate static ApplicationContext applicationContext;\r\n \t@Override\r\n    public void setApplicationContext(ApplicationContext arg0) throws BeansException {\r\n        applicationContext = arg0;\r\n    }\r\n}\r\n// æ³¨æ„ï¼šä»ApplicationContextAwareè·å–ApplicationContextä¸Šä¸‹æ–‡çš„æƒ…å†µï¼Œä»…ä»…é€‚ç”¨äºå½“å‰è¿è¡Œçš„ä»£ç å’Œå·²å¯åŠ¨çš„Springä»£ç å¤„äºåŒä¸€ä¸ªSpringä¸Šä¸‹æ–‡ï¼Œå¦åˆ™è·å–åˆ°çš„ApplicationContextæ˜¯ç©ºçš„\r\n\r\n6. BeanPostProcessor (å‰ç½®æ–¹æ³•)\r\nIOCå®¹å™¨ä¸­å¦‚æœæœ‰Beanå®ç°äº†è¯¥æ¥å£ï¼Œé‚£æ‰€æœ‰çš„Beanåœ¨åˆå§‹åŒ–ä¹‹å‰éƒ½ä¼šæ‰§è¡Œå…¶å®ä¾‹çš„postProcessBeforeInitialization(Object bean, String beanName)å‰ç½®æ–¹æ³•ï¼ŒBeanPostProcessorç»å¸¸è¢«ç”¨ä½œæ˜¯Beanå†…å®¹çš„æ›´æ”¹,è¯¥æ–¹æ³•æœ€åè¿”å›Bean\r\n7. @PostConstructä¿®é¥°çš„éé™æ€æ–¹æ³•\r\n8. InitializingBean\r\nå¦‚æœå®ç°äº†è¯¥æ¥å£ï¼Œåˆ™å…è®¸ä¸€ä¸ªBeanåœ¨å®ƒçš„æ‰€æœ‰å¿…é¡»å±æ€§è¢«BeanFactoryè®¾ç½®åï¼Œæ¥æ‰§è¡Œåˆå§‹åŒ–çš„å·¥ä½œï¼Œä¼šè‡ªåŠ¨è°ƒç”¨afterPropertiesSet()æ–¹æ³•å¯¹Beanè¿›è¡Œåˆå§‹åŒ–ï¼Œå®ç°æ­¤æ¥å£çš„è¯æ­£å¸¸æƒ…å†µä¸‹é…ç½®æ–‡ä»¶å°±ä¸ç”¨æŒ‡å®šinit-methodå±æ€§äº†ã€‚\r\n9. å¦‚æœBeanåœ¨Springä¸­é…ç½®äº†init-methodå±æ€§ï¼Œè°ƒç”¨init-methodå±æ€§æŒ‡å‘çš„æ–¹æ³•,æ­¤æ—¶å®ŒæˆBeançš„åˆå§‹åŒ–\r\n10. BeanPostProcessor(åç½®æ–¹æ³•)\r\nIOCå®¹å™¨ä¸­å¦‚æœæœ‰Beanå®ç°äº†æ¥å£ï¼Œé‚£æ‰€æœ‰çš„Beanåœ¨åˆå§‹åŒ–ä¹‹åéƒ½ä¼šæ‰§è¡Œå…¶å®ä¾‹çš„postProcessAfterInitialization(Object bean, String beanName)åç½®æ–¹æ³•\r\n11. å®ç°SmartInitializingSingletonçš„æ¥å£åï¼Œå½“æ‰€æœ‰å•ä¾‹Beanéƒ½åˆå§‹åŒ–å®Œæˆä»¥åï¼ŒSpringçš„IOCå®¹å™¨ä¼šå›è°ƒè¯¥æ¥å£çš„afterSingletonsInstantiated()æ–¹æ³•,ä¸»è¦åº”ç”¨åœºåˆå°±æ˜¯åœ¨æ‰€æœ‰å•ä¾‹Beanåˆ›å»ºå®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨è¯¥å›è°ƒä¸­åšä¸€äº›äº‹æƒ…ã€‚æ‰§è¡Œæ—¶æœºåœ¨ApplicationContextAwareæ‰§è¡Œä¹‹å\r\n12. @PreDestroyä¿®é¥°çš„æ–¹æ³•\r\n13. IOCå®¹å™¨å…³é—­æ—¶ï¼Œå¦‚æœBeanå®ç°äº†DisposableBeanæ¥å£ï¼Œåˆ™æ‰§è¡Œå…¶destory()æ–¹æ³•ï¼Œåœ¨Beanç”Ÿå‘½å‘¨æœŸç»“æŸå‰è°ƒç”¨destory()æ–¹æ³•åšä¸€äº›æ”¶å°¾å·¥ä½œ,é‡å†™destroy()æ–¹æ³•\r\n14. å¦‚æœè¿™ä¸ªBeanåœ¨Springé…ç½®äº†destroy-methodå±æ€§ï¼Œæ‰§è¡Œdestory-methodå±æ€§æŒ‡å‘çš„æ–¹æ³•\r\n```\r\n\r\n![](/images/bean.png)\r\n\r\n**ç®€å•æ¥è¯´ä¸€ä¸ªBeançš„åŠ è½½é¡ºåºï¼šç±»æ„é€ æ–¹æ³• - postProcessBeforeInitializationå‰ç½®æ–¹æ³• - @PostConstructæ³¨è§£çš„æ–¹æ³• - InitializingBeançš„afterPropertiesSet()æ–¹æ³•- XMLä¸­å®šä¹‰çš„bean init-methodæ–¹æ³• - postProcessAfterInitializationåç½®æ–¹æ³•**\r\n\r\n- [Spring Bootå¯åŠ¨æ‰©å±•ç‚¹è¶…è¯¦ç»†æ€»ç»“ï¼Œå†ä¹Ÿä¸æ€•é¢è¯•å®˜é—®äº†](https://mp.weixin.qq.com/s/l0O3C_UiO3CdfNE2V73qmA)\r\n\r\n### BeanFactoryPostProcessorã€BeanPostProcessoråŒºåˆ«\r\n\r\nBeanFactoryPostProcessorï¼šé’ˆå¯¹beanå·¥å‚ï¼ŒBeanFactoryåç½®å¤„ç†å™¨ï¼Œæ˜¯å¯¹BeanDefinitionå¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œå¯ä»¥ä¿®æ”¹BeanDefinitionå¯¹è±¡ä¸­çš„å±æ€§ã€‚ï¼ˆBeanDefinitionï¼šå­˜å‚¨beanæ ‡ç­¾çš„ä¿¡æ¯ï¼Œç”¨æ¥ç”Ÿæˆbeanå®ä¾‹ï¼‰,BeanFactoryPostProcessoræ¥å£æ˜¯é’ˆå¯¹beanå®¹å™¨çš„ï¼Œå®ƒçš„å®ç°ç±»å¯ä»¥åœ¨å½“å‰BeanFactoryåˆå§‹åŒ–ï¼ˆspringå®¹å™¨åŠ è½½beanå®šä¹‰æ–‡ä»¶ï¼‰åï¼Œbeanå®ä¾‹åŒ–ä¹‹å‰ä¿®æ”¹beançš„å®šä¹‰å±æ€§ï¼Œè¾¾åˆ°å½±å“ä¹‹åå®ä¾‹åŒ–beançš„æ•ˆæœã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒSpringå…è®¸BeanFactoryPostProcessoråœ¨å®¹å™¨å®ä¾‹åŒ–ä»»ä½•å…¶å®ƒbeanä¹‹å‰è¯»å–é…ç½®å…ƒæ•°æ®ï¼Œå¹¶å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ï¼Œä¾‹å¦‚å¯ä»¥æŠŠbeançš„scopeä»singletonæ”¹ä¸ºprototypeï¼Œä¹Ÿå¯ä»¥æŠŠpropertyçš„å€¼ç»™ä¿®æ”¹æ‰ã€‚å¯ä»¥åŒæ—¶é…ç½®å¤šä¸ªBeanFactoryPostProcessorï¼Œå¹¶é€šè¿‡è®¾ç½®â€™orderâ€™å±æ€§æ¥æ§åˆ¶å„ä¸ªBeanFactoryPostProcessorçš„æ‰§è¡Œæ¬¡åº.\r\nBeanPostProcessorï¼šé’ˆå¯¹bean,Beanåç½®å¤„ç†å™¨ï¼Œæ˜¯å¯¹ç”Ÿæˆçš„Beanå¯¹è±¡è¿›è¡Œä¿®æ”¹ã€‚BeanPostProcessorèƒ½åœ¨springå®¹å™¨å®ä¾‹åŒ–beanä¹‹åï¼Œåœ¨æ‰§è¡Œbeançš„åˆå§‹åŒ–æ–¹æ³•å‰åï¼Œæ·»åŠ ä¸€äº›è‡ªå·±çš„å¤„ç†é€»è¾‘ã€‚åˆå§‹åŒ–æ–¹æ³•åŒ…æ‹¬ä»¥ä¸‹ä¸¤ç§ï¼š\r\n1. å®ç°InitializingBeanæ¥å£çš„beanï¼Œå¯¹åº”æ–¹æ³•ä¸ºafterPropertiesSet\r\n2. xmlå®šä¹‰ä¸­ï¼Œé€šè¿‡init-methodè®¾ç½®çš„æ–¹æ³•,BeanPostProcessoræ˜¯BeanFactoryPostProcessorä¹‹åæ‰§è¡Œçš„ã€‚\r\n\r\n\r\n### BeanFactroyã€ApplicationContextåŒºåˆ«\r\n\r\n1. BeanFactroyé‡‡ç”¨çš„æ˜¯å»¶è¿ŸåŠ è½½å½¢å¼æ¥æ³¨å…¥Beançš„ï¼Œå³åªæœ‰åœ¨ä½¿ç”¨åˆ°æŸä¸ªBeanæ—¶(è°ƒç”¨getBean())ï¼Œæ‰å¯¹è¯¥Beanè¿›è¡ŒåŠ è½½å®ä¾‹åŒ–ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±ä¸èƒ½å‘ç°ä¸€äº›å­˜åœ¨çš„Springçš„é…ç½®é—®é¢˜ã€‚è€ŒApplicationContextåˆ™ç›¸åï¼Œå®ƒæ˜¯åœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€æ¬¡æ€§åˆ›å»ºäº†æ‰€æœ‰çš„Beanã€‚è¿™æ ·ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘ç°Springä¸­å­˜åœ¨çš„é…ç½®é”™è¯¯ã€‚ç›¸å¯¹äºåŸºæœ¬çš„BeanFactoryï¼ŒApplicationContextå”¯ä¸€çš„ä¸è¶³æ˜¯å ç”¨å†…å­˜ç©ºé—´ã€‚å½“åº”ç”¨ç¨‹åºé…ç½®Beanè¾ƒå¤šæ—¶ï¼Œç¨‹åºå¯åŠ¨è¾ƒæ…¢ã€‚BeanFacotryå»¶è¿ŸåŠ è½½,å¦‚æœBeançš„æŸä¸€ä¸ªå±æ€§æ²¡æœ‰æ³¨å…¥ï¼ŒBeanFacotryåŠ è½½åï¼Œç›´è‡³ç¬¬ä¸€æ¬¡ä½¿ç”¨è°ƒç”¨getBeanæ–¹æ³•æ‰ä¼šæŠ›å‡ºå¼‚å¸¸ï¼›è€ŒApplicationContextåˆ™åœ¨åˆå§‹åŒ–è‡ªèº«æ˜¯æ£€éªŒï¼Œè¿™æ ·æœ‰åˆ©äºæ£€æŸ¥æ‰€ä¾èµ–å±æ€§æ˜¯å¦æ³¨å…¥ï¼›æ‰€ä»¥é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨ApplicationContextã€‚åº”ç”¨ä¸Šä¸‹æ–‡åˆ™ä¼šåœ¨ä¸Šä¸‹æ–‡å¯åŠ¨åé¢„è½½å…¥æ‰€æœ‰çš„å•å®ä¾‹Beanã€‚é€šè¿‡é¢„è½½å…¥å•å®ä¾‹bean,ç¡®ä¿å½“ä½ éœ€è¦çš„æ—¶å€™ï¼Œä½ å°±ä¸ç”¨ç­‰å¾…ï¼Œå› ä¸ºå®ƒä»¬å·²ç»åˆ›å»ºå¥½äº†ã€‚\r\n2. BeanFactoryå’ŒApplicationContextéƒ½æ”¯æŒBeanPostProcessorã€BeanFactoryPostProcessorçš„ä½¿ç”¨ï¼Œä½†ä¸¤è€…ä¹‹é—´çš„åŒºåˆ«æ˜¯ï¼šBeanFactoryéœ€è¦æ‰‹åŠ¨æ³¨å†Œï¼Œè€ŒApplicationContextåˆ™æ˜¯è‡ªåŠ¨æ³¨å†Œã€‚ï¼ˆApplicationcontextæ¯”beanFactoryåŠ å…¥äº†ä¸€äº›æ›´å¥½ä½¿ç”¨çš„åŠŸèƒ½ã€‚è€Œä¸”beanFactoryçš„è®¸å¤šåŠŸèƒ½éœ€è¦é€šè¿‡ç¼–ç¨‹å®ç°è€ŒApplicationcontextå¯ä»¥é€šè¿‡é…ç½®å®ç°ã€‚æ¯”å¦‚åå¤„ç†beanï¼ŒApplicationcontextç›´æ¥é…ç½®åœ¨é…ç½®æ–‡ä»¶å³å¯è€ŒbeanFactoryè¿™è¦åœ¨ä»£ç ä¸­æ˜¾ç¤ºçš„å†™å‡ºæ¥æ‰å¯ä»¥è¢«å®¹å™¨è¯†åˆ«ã€‚ï¼‰\r\n3. beanFactoryä¸»è¦æ˜¯é¢å¯¹ä¸springæ¡†æ¶çš„åŸºç¡€è®¾æ–½ï¼Œé¢å¯¹springè‡ªå·±ã€‚è€ŒApplicationcontexä¸»è¦é¢å¯¹ä¸springä½¿ç”¨çš„å¼€å‘è€…ã€‚åŸºæœ¬éƒ½ä¼šä½¿ç”¨Applicationcontexå¹¶ébeanFactoryã€‚\r\n[Springç³»åˆ—ä¹‹beanFactoryä¸ApplicationContext](https://mp.weixin.qq.com/s?__biz=Mzg2MDYzODI5Nw==&mid=2247493943&idx=1&sn=9eaa46ed730874fce003c66f76fe9c7f&source=41#wechat_redirect)\r\n\r\n\r\n\r\n### BeanFactoryå’ŒFactoryBeançš„åŒºåˆ«\r\n\r\nBeanFactoryæ˜¯Springå®¹å™¨çš„é¡¶çº§æ¥å£ï¼Œç»™å…·ä½“çš„IOCå®¹å™¨çš„å®ç°æä¾›äº†è§„èŒƒã€‚\r\nFactoryBeanä¹Ÿæ˜¯æ¥å£ï¼Œä¸ºIOCå®¹å™¨ä¸­Beançš„å®ç°æä¾›äº†æ›´åŠ çµæ´»çš„æ–¹å¼ï¼ŒFactoryBeanåœ¨IOCå®¹å™¨çš„åŸºç¡€ä¸Šç»™Beançš„å®ç°åŠ ä¸Šäº†â¼€ä¸ªç®€å•å·¥å‚æ¨¡å¼å’Œè£…é¥°æ¨¡å¼,æˆ‘ä»¬å¯ä»¥åœ¨getObject()æ–¹æ³•ä¸­çµæ´»é…ç½®ã€‚å…¶å®åœ¨Springæºç ä¸­æœ‰å¾ˆå¤šFactoryBeançš„å®ç°ç±»ã€‚\r\nåŒºåˆ«ï¼šBeanFactoryæ˜¯ä¸ªFactoryï¼Œä¹Ÿå°±æ˜¯IOCå®¹å™¨æˆ–å¯¹è±¡å·¥å‚ï¼ŒFactoryBeanæ˜¯ä¸ªBeanã€‚åœ¨Springä¸­ï¼Œæ‰€æœ‰çš„Beanéƒ½æ˜¯ç”±BeanFactory(ä¹Ÿå°±æ˜¯IOCå®¹å™¨)æ¥è¿›è¡Œç®¡ç†çš„ã€‚ä½†å¯¹FactoryBeanè€Œè¨€ï¼Œè¿™ä¸ªBeanä¸æ˜¯ç®€å•çš„Beanï¼Œè€Œæ˜¯â¼€ä¸ªèƒ½ç”Ÿäº§æˆ–è€…ä¿®é¥°å¯¹è±¡ç”Ÿæˆçš„å·¥å‚Bean,å®ƒçš„å®ç°ä¸è®¾è®¡æ¨¡å¼ä¸­çš„å·¥å‚æ¨¡å¼å’Œä¿®é¥°å™¨æ¨¡å¼ç±»ä¼¼ã€‚\r\n\r\n#### BeanFactory\r\n\r\nBeanFactoryï¼Œä»¥Factoryç»“å°¾ï¼Œè¡¨ç¤ºå®ƒæ˜¯â¼€ä¸ªå·¥å‚ç±»(æ¥å£)ï¼Œå®ƒè´Ÿè´£ç”Ÿäº§å’Œç®¡ç†beançš„â¼€ä¸ªå·¥å‚ã€‚åœ¨Springä¸­ï¼ŒBeanFactoryæ˜¯IOCå®¹å™¨çš„æ ¸å¿ƒæ¥å£ï¼Œå®ƒçš„èŒè´£åŒ…æ‹¬ï¼šå®ä¾‹åŒ–ã€å®šä½ã€é…ç½®åº”ç”¨ç¨‹åºä¸­çš„å¯¹è±¡åŠå»ºç«‹è¿™äº›å¯¹è±¡é—´çš„ä¾èµ–ã€‚\r\nBeanFactoryåªæ˜¯ä¸ªæ¥å£ï¼Œå¹¶ä¸æ˜¯IOCå®¹å™¨çš„å…·ä½“å®ç°ï¼Œä½†æ˜¯Springå®¹å™¨ç»™å‡ºäº†å¾ˆå¤šç§å®ç°ï¼Œå¦‚DefaultListableBeanFactoryã€XmlBeanFactoryã€ApplicationContextç­‰ï¼Œå…¶ä¸­XmlBeanFactoryå°±æ˜¯å¸¸ç”¨çš„â¼€ä¸ªï¼Œè¯¥å®ç°å°†ä»¥XMLæ–¹å¼æè¿°ç»„æˆåº”ç”¨çš„å¯¹è±¡åŠå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ã€‚XmlBeanFactoryç±»å°†æŒæœ‰æ­¤XMLé…ç½®å…ƒæ•°æ®ï¼Œå¹¶ç”¨å®ƒæ¥æ„å»ºâ¼€ä¸ªå®Œå…¨å¯é…ç½®çš„ç³»ç»Ÿæˆ–åº”ç”¨ã€‚éƒ½æ˜¯é™„åŠ äº†æŸç§åŠŸèƒ½çš„å®ç°ã€‚å®ƒä¸ºå…¶ä»–å…·ä½“çš„IOCå®¹å™¨æä¾›äº†æœ€åŸºæœ¬çš„è§„èŒƒï¼Œä¾‹å¦‚DefaultListableBeanFactory,XmlBeanFactory,ApplicationContextç­‰å…·ä½“çš„å®¹å™¨éƒ½æ˜¯å®ç°äº†BeanFactoryï¼Œå†åœ¨å…¶åŸºç¡€ä¹‹ä¸Šé™„åŠ äº†å…¶ä»–çš„åŠŸèƒ½ã€‚\r\nBeanFactoryå’ŒApplicationContextå°±æ˜¯Springæ¡†æ¶çš„ä¸¤ä¸ªIOCå®¹å™¨ï¼Œç°åœ¨â¼€èˆ¬ä½¿ç”¨ApplicationnContextï¼Œå…¶ä¸ä½†åŒ…å«äº†BeanFactoryçš„ä½œç”¨ï¼ŒåŒæ—¶è¿˜è¿›è¡Œæ›´å¤šçš„æ‰©å±•ã€‚\r\nBeanFacotryæ˜¯Springä¸­æ¯”è¾ƒåŸå§‹çš„Factoryã€‚å¦‚XMLBeanFactoryå°±æ˜¯â¼€ç§å…¸å‹çš„BeanFactoryã€‚åŸå§‹çš„BeanFactoryæ— æ³•â½€æŒSpringçš„è®¸å¤šæ’ä»¶ï¼Œå¦‚AOPåŠŸèƒ½ã€Webåº”ç”¨ç­‰ã€‚ApplicationContextæ¥å£,å®ƒç”±BeanFactoryæ¥å£æ´¾ç”Ÿè€Œæ¥ï¼ŒApplicationContextåŒ…å«BeanFactoryçš„æ‰€æœ‰åŠŸèƒ½ï¼Œé€šå¸¸å»ºè®®æ¯”BeanFactoryä¼˜å…ˆï¼ŒApplicationContextä»¥â¼€ç§æ›´é¢å‘æ¡†æ¶çš„æ–¹å¼å·¥ä½œä»¥åŠå¯¹ä¸Šä¸‹æ–‡è¿›è¡Œåˆ†å±‚å’Œå®ç°ç»§æ‰¿ï¼ŒApplicationContextåŒ…è¿˜æä¾›äº†ä»¥ä¸‹çš„åŠŸèƒ½ï¼š\r\nMessageSource,æä¾›å›½é™…åŒ–çš„æ¶ˆæ¯è®¿é—®\r\nèµ„æºè®¿é—®ï¼Œå¦‚URLå’Œâ½‚ä»¶\r\näº‹ä»¶ä¼ æ’­\r\nè½½å…¥å¤šä¸ªï¼ˆæœ‰ç»§æ‰¿å…³ç³»ï¼‰ä¸Šä¸‹æ–‡ï¼Œä½¿å¾—æ¯â¼€ä¸ªä¸Šä¸‹æ–‡éƒ½ä¸“æ³¨äºâ¼€ä¸ªç‰¹å®šçš„å±‚æ¬¡ï¼Œæ¯”å¦‚åº”â½¤çš„webå±‚;\r\nBeanFactoryæä¾›çš„æ–¹æ³•åŠå…¶ç®€å•ï¼Œä»…æä¾›äº†å…­ç§æ–¹æ³•ä¾›å®¢æˆ·è°ƒç”¨ï¼š\r\n```java\r\n// åˆ¤æ–­â¼¯â¼šä¸­æ˜¯å¦åŒ…å«ç»™å®šåç§°çš„beanå®šä¹‰ï¼Œè‹¥æœ‰åˆ™è¿”å›true\r\nboolean containsBean(String beanName)\r\n// è¿”å›ç»™å®šåç§°æ³¨å†Œçš„beanå®ä¾‹ã€‚æ ¹æ®beançš„é…ç½®æƒ…å†µï¼Œå¦‚æœæ˜¯singletonæ¨¡å¼å°†è¿”å›â¼€ä¸ªå…±äº«å®ä¾‹ï¼Œå¦åˆ™å°†è¿”å›â¼€ä¸ªæ–°å»ºçš„å®ä¾‹ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŒ‡å®šbean,è¯¥â½…æ³•å¯èƒ½ä¼šæŠ›å‡ºå¼‚å¸¸\r\nObject getBean(String)\r\n// è¿”å›ä»¥ç»™å®šåç§°æ³¨å†Œçš„beanå®ä¾‹ï¼Œå¹¶è½¬æ¢ä¸ºç»™å®šclassç±»å‹\r\nObject getBean(String, Class)\r\n// è¿”å›ç»™å®šåç§°çš„beançš„Class,å¦‚æœæ²¡æœ‰æ‰¾åˆ°æŒ‡å®šçš„beanå®ä¾‹ï¼Œåˆ™æ’é™¤NoSuchBeanDefinitionExceptionå¼‚å¸¸\r\nClass getType(String name)\r\n// åˆ¤æ–­ç»™å®šåç§°çš„beanå®šä¹‰æ˜¯å¦ä¸ºå•ä¾‹æ¨¡å¼\r\nboolean isSingleton(String)\r\n// è¿”å›ç»™å®šbeanåç§°çš„æ‰€æœ‰åˆ«å\r\nString[] getAliases(String name)\r\n```\r\n#### FactoryBean\r\n\r\nâ¼€èˆ¬æƒ…å†µä¸‹ï¼ŒSpringé€šè¿‡åå°„æœºåˆ¶åˆ©ç”¨<bean\\><bean\\>çš„classå±æ€§æŒ‡å®šå®ç°ç±»å®ä¾‹åŒ–Beanï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ä¾‹åŒ–Beanè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå¦‚æœæŒ‰ç…§ä¼ ç»Ÿçš„æ–¹å¼ï¼Œåˆ™éœ€è¦åœ¨<bean\\><bean\\>ä¸­æä¾›å¤§é‡çš„é…ç½®ä¿¡æ¯ã€‚é…ç½®â½…å¼çš„çµæ´»æ€§æ˜¯å—é™çš„ï¼Œè¿™æ—¶é‡‡ç”¨ç¼–ç çš„æ–¹å¼å¯èƒ½ä¼šå¾—åˆ°â¼€ä¸ªç®€å•çš„æ–¹æ¡ˆã€‚\r\nSpringä¸ºæ­¤æä¾›äº†â¼€ä¸ªorg.springframework.bean.factory.FactoryBeançš„å·¥å‚ç±»æ¥å£ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡å®ç°è¯¥æ¥â¼å®šåˆ¶å®ä¾‹åŒ–Beançš„é€»è¾‘ã€‚FactoryBeanæ¥å£å¯¹äºSpringæ¡†æ¶æ¥è¯´å é‡è¦çš„åœ°ä½ï¼ŒSpringè‡ªèº«å°±æä¾›äº†70å¤šä¸ªFactoryBeançš„å®ç°ã€‚å®ƒä»¬éšè—äº†å®ä¾‹åŒ–â¼€äº›å¤æ‚Beançš„ç»†èŠ‚ï¼Œç»™ä¸Šå±‚åº”ç”¨å¸¦æ¥äº†ä¾¿åˆ©ã€‚ä»Spring3.0å¼€å§‹ï¼ŒFactoryBeanå¼€å§‹â½€æŒæ³›å‹ï¼Œå³æ¥å£å£°æ˜æ”¹ä¸ºFactoryBean<T\\>çš„å½¢å¼,ä»¥Beanç»“å°¾ï¼Œè¡¨ç¤ºå®ƒæ˜¯â¼€ä¸ªBeanï¼Œä¸åŒäºæ™®é€šBeançš„æ˜¯ï¼šå®ƒæ˜¯å®ç°äº†FactoryBean<T\\>æ¥å£çš„Beanï¼Œæ ¹æ®è¯¥Beançš„IDä»BeanFactoryä¸­è·å–çš„å®é™…ä¸Šæ˜¯FactoryBeançš„getObject()è¿”å›çš„å¯¹è±¡ï¼Œè€Œä¸æ˜¯FactoryBeanæœ¬èº«ï¼Œå¦‚æœè¦è·å–FactoryBeanå¯¹è±¡ï¼Œè¯·åœ¨idå‰é¢åŠ â¼€ä¸ª&ç¬¦å·æ¥è·å–ã€‚\r\nä¾‹å¦‚è‡ªå·±å®ç°â¼€ä¸ªFactoryBeanï¼ŒåŠŸèƒ½ï¼šç”¨æ¥ä»£ç†â¼€ä¸ªå¯¹è±¡ï¼Œå¯¹è¯¥å¯¹è±¡çš„æ‰€æœ‰æ–¹æ³•åšâ¼€ä¸ªæ‹¦æˆªï¼Œåœ¨è°ƒç”¨å‰åéƒ½è¾“å‡ºâ¼€è¡ŒLOGï¼Œæ¨¡ä»¿ProxyFactoryBeançš„åŠŸèƒ½ã€‚FactoryBeanæ˜¯â¼€ä¸ªæ¥å£ï¼Œå½“åœ¨IOCå®¹å™¨ä¸­çš„Beanå®ç°äº†FactoryBeanåï¼Œé€šè¿‡getBean(StringBeanName)è·å–åˆ°çš„Beanå¯¹è±¡å¹¶ä¸æ˜¯FactoryBeançš„å®ç°ç±»å¯¹è±¡ï¼Œè€Œæ˜¯è¿™ä¸ªå®ç°ç±»ä¸­çš„getObject()æ–¹æ³•è¿”å›çš„å¯¹è±¡ã€‚è¦æƒ³è·å–FactoryBeançš„å®ç°ç±»ï¼Œå°±è¦getBean(&BeanName)ï¼Œåœ¨BeanNameä¹‹å‰åŠ ä¸Š&ã€‚\r\nåœ¨è¯¥æ¥å£ä¸­è¿˜å®šä¹‰äº†ä»¥ä¸‹3ä¸ªâ½…æ³•ï¼š\r\n```java\r\n// è¿”å›ç”±FactoryBeanåˆ›å»ºçš„Beanå®ä¾‹ï¼Œå¦‚æœisSingleton()è¿”å›trueï¼Œåˆ™è¯¥å®ä¾‹ä¼šæ”¾åˆ°Springå®¹å™¨ä¸­å•å®ä¾‹ç¼“å­˜æ± ä¸­ï¼›\r\nT getObject() throw Exception;\r\n// è¿”å›ç”±FactoryBeanåˆ›å»ºçš„Beanå®ä¾‹çš„ä½œâ½¤åŸŸæ˜¯singletonè¿˜æ˜¯prototypeï¼›\r\nboolean isSingleton();\r\n// è¿”å›FactoryBeanåˆ›å»ºçš„Beanç±»å‹ã€‚å½“é…ç½®â½‚ä»¶ä¸­<bean>çš„classå±æ€§é…ç½®çš„å®ç°ç±»æ˜¯FactoryBeanæ—¶ï¼Œé€šè¿‡getBean()â½…æ³•è¿”å›çš„ä¸æ˜¯FactoryBeanæœ¬èº«ï¼Œâ½½æ˜¯FactoryBean#getObject()â½…æ³•æ‰€è¿”å›çš„å¯¹è±¡ï¼Œç›¸å½“äºFactoryBean#getObject()ä»£ç†äº†getBean()â½…æ³•ã€‚\r\nClass<?> getObjectType();\r\n```\r\n**æ€»ç»“**\r\nBeanFactoryæ˜¯ä¸ªFactoryï¼Œä¹Ÿå°±æ˜¯IOCå®¹å™¨æˆ–å¯¹è±¡å·¥å‚ï¼ŒFactoryBeanæ˜¯ä¸ªBeanã€‚åœ¨Springä¸­ï¼Œæ‰€æœ‰çš„Beanéƒ½æ˜¯ç”±BeanFactory(ä¹Ÿå°±æ˜¯IOCå®¹å™¨)æ¥è¿›è¡Œç®¡ç†çš„ã€‚ä½†å¯¹FactoryBeanè€Œè¨€ï¼Œè¿™ä¸ªBeanä¸æ˜¯ç®€å•çš„Beanï¼Œè€Œæ˜¯â¼€ä¸ªèƒ½ç”Ÿäº§æˆ–è€…ä¿®é¥°å¯¹è±¡ç”Ÿæˆçš„å·¥å‚Bean,å®ƒçš„å®ç°ä¸è®¾è®¡æ¨¡å¼ä¸­çš„å·¥å‚æ¨¡å¼å’Œä¿®é¥°å™¨æ¨¡å¼ç±»ä¼¼\r\n\r\n\r\n### Beançš„è°ƒç”¨\r\n\r\n```java\r\n// 1ã€ä½¿ç”¨BeanWrapper\r\nHelloWorld hw = new HelloWorld();\r\nBeanWrapper bw = new BeanWrapperImpl(hw);\r\nbw.setPropertyvalue(\"msg\",\"HelloWorld\");\r\nSystem.out.println(bw.getPropertyCalue(\"msg\"));\r\n// 2ã€ä½¿ç”¨BeanFactory\r\nInputStream is = new FileInputStream(\"config.xml\");\r\nXmlBeanFactory factory = new XmlBeanFactory(is);\r\nHelloWorld hw = (HelloWorld) factory.getBean(\"HelloWorld\");\r\nSystem.out.println(hw.getMsg());\r\n// 3ã€ä½¿ç”¨ApplicationContext\r\nApplicationContext actx = new FleSystemXmlApplicationContext(\"config.xml\");\r\nHelloWorld hw = (HelloWorld) actx.getBean(\"HelloWorld\");\r\nSystem.out.println(hw.getMsg());\r\n```\r\n[Springä¸­è·å–Beançš„å…«ç§æ–¹å¼](https://mp.weixin.qq.com/s/BW3khRkQwjBsXw7yJhCyXQ)\r\n\r\n\r\n## ç›¸å…³æ–‡ç« \r\n\r\n- [11å¼ æµç¨‹å›¾å¸®ä½ æå®šSpring Beanç”Ÿå‘½å‘¨æœŸ](https://mp.weixin.qq.com/s/I8tsf7cFXkHX1pUp7SPByw)\r\n- [é¢è¯•å®˜ï¼šè¯´è¯´Spring Beançš„å®ä¾‹åŒ–è¿‡ç¨‹ï¼Ÿé¢è¯•å¿…é—®çš„ï¼](https://mp.weixin.qq.com/s/5hAt9_KyyqHy7zzOjZ9LyQ)\r\n- [ä½ çŸ¥é“Spring lazy-initæ‡’åŠ è½½çš„åŸç†å—ï¼Ÿ](https://mp.weixin.qq.com/s/_je69-0J72X5YMCrS-92MQ)\r\n- [å¦‚ä½•è‡ªå·±å®ç°ä¸€ä¸ªç®€å•çš„Spring Beanå®¹å™¨](https://mp.weixin.qq.com/s/brlEwyKhwhSkljHLL1zmBA)\r\n- [å®åŠ›æ€»ç»“å››ç±»Beanæ³¨å…¥Springçš„æ–¹å¼](https://mp.weixin.qq.com/s/AuTnuxIQDPFbuslDz9ffVg)\r\n- [å…³äºSpringæ³¨å…¥æ–¹å¼çš„å‡ é“é¢è¯•é¢˜ï¼Œä½ èƒ½ç­”ä¸Šä¹ˆ](https://mp.weixin.qq.com/s?__biz=Mzg2MDYzODI5Nw==&amp;mid=2247494432&amp;idx=1&amp;sn=3acc7e7bf31c6d1f56ad830d6eb1ec41&amp;source=41#wechat_redirect)\r\n- [æœ€å…¨çš„Springä¾èµ–æ³¨å…¥æ–¹å¼ï¼Œä½ éƒ½ä¼šäº†å—ï¼Ÿ](https://mp.weixin.qq.com/s/u1DcCsRrrHYFOVykwW4Dcg)\r\n- [Springå®˜æ–¹ä¸ºä»€ä¹ˆå»ºè®®æ„é€ å™¨æ³¨å…¥ï¼Ÿ](https://mp.weixin.qq.com/s/fVV6dYh0DQOoDiXwLR5miw)\r\n- [Beanæ”¾å…¥Springå®¹å™¨ï¼Œä½ çŸ¥é“å‡ ç§æ–¹å¼ï¼Ÿ](https://mp.weixin.qq.com/s/g9iRu1slTMx0dwYJiy2m7w)\r\n- [Springæ³¨å…¥Beançš„7ç§æ–¹å¼ï¼Œè¿˜æœ‰è°ä¸ä¼šï¼Ÿï¼Ÿ](https://mp.weixin.qq.com/s/i0Y-p7mda5FJCWCMJ8msdg)\r\n- [Springæ³¨è§£@Beanå’Œ@Componentçš„åŒºåˆ«,ä½ çŸ¥é“å—ï¼Ÿ](https://mp.weixin.qq.com/s/6CwABJAePAT6hzTmfk7Jjg)\r\n- [@Beanä¸@Componentç”¨åœ¨åŒä¸€ä¸ªç±»ä¸Šï¼Œä¼šæ€ä¹ˆæ ·ï¼Ÿ](https://mp.weixin.qq.com/s/lyH72PRAGcR2-aQvMZ1jPA)\r\n- [Beanå¼‚æ­¥åˆå§‹åŒ–ï¼Œè®©ä½ çš„åº”ç”¨å¯åŠ¨é£èµ·æ¥](https://mp.weixin.qq.com/s/aZCgJS3Uaj28UiKTtUFcmw)","categories":[{"name":"Spring","path":"api/categories/Spring.json"}],"tags":[]}