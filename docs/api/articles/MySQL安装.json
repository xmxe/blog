{"title":"MySQL安装","slug":"MySQL安装","date":"2022-09-28T03:05:54.266Z","updated":"2023-07-06T03:00:43.672Z","comments":true,"path":"api/articles/MySQL安装.json","excerpt":null,"covers":"https://img0.baidu.com/it/u=730256309,1700139135&fm=253&fmt=auto&app=138&f=JPEG?w=899&h=500","content":"\r\n\r\n## Linux安装MySQL\r\n\r\n### 压缩包安装\r\n\r\n#### 1. 下载\r\n\r\n~~[MySQL下载地址](https://downloads.mysql.com/archives/community/)~~,[MySQL下载地址](https://dev.mysql.com/downloads/)下载后将安装包上传usr/local\r\n\r\n#### 2. 解压\r\n\r\n```shell\r\ntar -zxvf mysql-5.6.33-linux-glibc2.5-x86_64.tar.gz\r\n```\r\n> 解压后位置usr/local/mysql\r\n\r\n#### 3. 创建用户及用户组\r\n\r\n先检查是否有mysql用户组和mysql用户,没有就添加\r\n```shell\r\n# 查看所有用户\r\ncat /etc/passwd\r\n# 查看用户组\r\ngroups mysql\r\n# 添加用户组\r\ngroupadd mysql\r\n# 删除用户组 groupdel\r\n```\r\n添加用户mysql然后将mysql用户添加到到用户组mysql\r\n```shell\r\n# -r建立系统帐号 -g<群组>指定用户所属的群组。\r\nuseradd -r -g mysql mysql\r\n# userdel删除\r\n```\r\n#### 4. 操作\r\n\r\n修改配置文件vim /etc/my.cnf（没有就新建）\r\n```shell\r\n[client]\r\ndefault_character_set=utf8mb4\r\n\r\n[mysql]\r\ndefault_character_set=utf8mb4\r\n\r\n[mysqld]\r\n# *\t接收所有的IPv4或IPv6连接请求\r\n# 0.0.0.0接受所有的IPv4地址\r\n# ::接受所有的IPv4或IPv6地址\r\n# IPv4-mapped接受所有的IPv4地址或IPv4邦定格式的地址（例 ::ffff:127.0.0.1）\r\n# IPv4（IPv6）只接受对应的IPv4（IPv6）地址\r\nbind-address=0.0.0.0\r\n# port=3306\r\n# 指定安装用户\r\nuser=mysql\r\nbasedir=/usr/local/mysql\r\ndatadir=/usr/local/mysql/data\r\nsocket=/tmp/mysql.sock\r\nlog-error=/usr/local/mysql/mysql.err\r\npid-file=/usr/local/mysql/data/mysql/mysql.pid\r\ncharacter_set_server=utf8mb4\r\n# 符号连接,如果设置为1,则mysql数据库和表里的数据支持储存在datadir目录之外的路径下,默认都是0\r\nsymbolic-links=0\r\n# 默认情况下，timestamp类型字段所在数据行被更新时，该字段会自动更新为当前时间，而参数explicit_defaults_for_timestamp控制这一种行为。\r\n# 数据行更新时，timestamp类型字段更新为当前时间\r\n# explicit_defaults_for_timestamp=off\r\n# 数据行更新时，timestamp类型字段不更新为当前时间。\r\n# explicit_defaults_for_timestamp=on\r\n# 允许最大连接数\r\nmax_connections=200\r\ndefault-storage-engine=INNODB\r\n# 连接层默认字符集\r\ncollation-server=utf8mb4_unicode_ci\r\nwait_timeout=31536000\r\ninteractive_timeout=31536000\r\n```\r\n\r\n进入安装mysql软件目录`cd mysql/`,修改目录拥有者为mysql用户`chown -R mysql:mysql ./`\r\n\r\n##### 5.6版本\r\n\r\n```shell\r\n# --defaults-file指定配置文件 --basedir指定Mysql安装目录 --datadir指定数据目录 --user所属用户\r\n./scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data\r\n```\r\n\r\n> 此处可能出现错误\r\n>\r\n> **错误1**：命令报错`-bash: ./scripts/mysql_install_db: /usr/bin/perl: bad interpreter: No such file or directory.`貌似提示注释器错误，没有/usr/bin/perl文件或者档案\r\n> **解决办法**:（安装perl跟perl-devel即可）：执行**yum -y install perl perl-devel**后在初始化数据库即可。\r\n>\r\n> **错误2**：`FATAL ERROR: please install the following Perl modules before executing * Data::Dumper`\r\n> **解决办法:yum install -y perl-Data-Dumper**\r\n>\r\n> 修改当前目录拥有者为root用户\r\n> ```shell\r\n> chown -R root:root ./\r\n> ```\r\n> 再次运行\r\n> ```shell\r\n> ./scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql --datadir=/usr/local/mysql/data\r\n> ```\r\n> 修改当前data目录拥有者为mysql用户\r\n> ```shell\r\n> chown -R mysql:mysql data\r\n> ```\r\n\r\n##### 5.7版本\r\n\r\n执行命令\r\n```shell\r\n./mysqld --defaults-file=/etc/my.cnf --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/ --user=mysql --initialize\r\n```\r\n查看初始密码,控制台查看或者`cat /usr/local/mysql/mysql.err`localhost:后面的一串字符就是初始密码\r\n\r\n##### 8.0版本\r\n\r\n```shell\r\nbin/mysqld --user=mysql --initialize --datadir=/usr/local/mysql/data\r\n```\r\nroot@localhost之后的一串字符就是初始密码\r\n\r\n> **错误1**：服务未成功启动查看data目录下的localhost.localdomain.err错误日志\r\n> 遇到`Can't start server : Bind on unix socket: Address already in use Do you already have another mysqld server running on socket: /tmp/mysql.sock ?`解决方法是删除 rm -rf /tmp/mysql.sock(由于以前安装过mysql的原因)\r\n>\r\n> **错误2**：./mysqld: error while loading shared libraries: libnuma.so.1: cannot open shared object file: No such file or directory就执行下`yum install -y libaio`、` yum -y install numactl`后再执行初始化\r\n\r\n#### 5. 启动mysql\r\n\r\n添加开机启动，把启动脚本放到开机初始化目录。\r\n\r\n```shell\r\ncp /usr/local/mysql/support-files/mysql.server /etc/init.d/mysql\r\n```\r\n赋予可执行权限\r\n```shell\r\nchmod +x /etc/init.d/mysql\r\n```\r\n启动mysql服务\r\n```shell\r\nservice mysql start\r\n```\r\n\r\n#### 6. 修改密码\r\n\r\n```shell\r\n# 测试进入mysql\r\nmysql -uroot -proot\r\n# UPDATE直接编辑user表\r\nupdate mysql.user set password=password('新密码') where host='localhost' and user='root';\r\n# 或者使用SET PASSWORD命令\r\nset password for root@localhost = password('新密码');\r\n# 或者使用mysqladmin修改密码\r\n./bin/mysqladmin -hlocalhost.localdomain -uroot -p旧密码 password '新密码'\r\n# MySQL8使用\r\nupdate user set authentication_string='' where user='root';# 将字段置为空\r\nALTER user 'root'@'localhost' IDENTIFIED BY 'root';#修改密码为root\r\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '新密码';\r\n# 进入mysql更改密码\r\nset password='root';\r\n# 使密码生效\r\nflush privileges;\r\n```\r\n\r\n#### 7. 修改远程连接\r\n\r\n改表法\r\n```shell\r\nuse mysql\r\nupdate user set host='%' where user='root';\r\nflush privileges;\r\n```\r\n授权法\r\n```shell\r\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'%' IDENTIFIED BY '密码' WITH GRANT OPTION;\r\n# 如果你想允许用户myuser从ip为192.168.1.6的主机连接到mysql服务器，并使用mypassword作为密码\r\nGRANT ALL PRIVILEGES ON *.* TO 'myuser'@'192.168.1.3' IDENTIFIED BY 'mypassword' WITH GRANT OPTION;\r\n```\r\n\r\n#### 8. 其他\r\n\r\n添加服务自启动\r\n```shell\r\nchkconfig --add mysql\r\n```\r\n显示服务列表\r\n```shell\r\nchkconfig --list\r\n# 如果看到mysql的服务，并且3,4,5都是on的话则成功，如果是off，则执行\r\nchkconfig --level 345 mysql on\r\n```\r\n\r\n> 假如服务未成功启动[log-error set to '/var/log/mariadb/mariadb.log', however file don't exists](http://blog.csdn.net/duyuanhai/article/details/78604894)**报错的情况下执行以下操作**:需要创建报错中缺失的文件夹`mkdir z/var/log/mariadb，touch /var/log/mariadb/mariadb.log`\r\n\r\n创建软连接\r\n```shell\r\nln -s /usr/local/mysql/bin/mysql /usr/local/bin/mysql\r\n```\r\nmysql -uroot -proot无法连接的话\r\n\r\n```shell\r\nln -s /var/lib/mysql/mysql.sock /tmp/mysql.sock\r\n```\r\n\r\n默认配置文件路径如下\r\n\r\n```\r\n配置文件：/etc/my.cnf\r\n日志文件：/var/log/var/log/mysqld.log\r\n服务启动脚本：/usr/lib/systemd/system/mysqld.service\r\nsocket文件：/var/run/mysqld/mysqld.pid\r\n```\r\n### yum安装\r\n\r\n#### 一、安装本地YUM源、MySQL在MySQL官网中下载YUM源rpm安装包\r\n\r\n(1) 把上面的rpm文件下载下来放到服务器上,或者在linux系统中通过wget命令下载\r\n\r\n```shell\r\nwget http://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm\r\n```\r\n\r\n(2) 下载完成后使用yum命令本地安装yum源\r\n\r\n```shell\r\nyum localinstall mysql80-community-release-el7-1.noarch.rpm\r\n```\r\n\r\n(3) 执行完毕后使用下面的命令检查是否安装成功\r\n\r\n```shell\r\nyum repolist enabled | grep \"mysql.*-community.*\"\r\n```\r\n\r\n(4) 安装服务器\r\n\r\n```shell\r\nyum install -y mysql-community-server\r\n```\r\n\r\n#### 二、配置MySQL\r\n\r\n服务命令\r\n```shell\r\n# 启动MySQL服务\r\nsystemctl start mysqld\r\n# 查看服务启动状态\r\nsystemctl status mysqld\r\n# 开机启动\r\nsystemctl enable mysqld\r\n# 重新加载开机启动配置\r\nsystemctl daemon-reload\r\n\r\n# 修改root默认密码\r\n# 查询默认密码\r\ncat /var/log/mysqld.log | grep 'temporary password'\r\n# 登录mysql,用刚才从文件中找到的密码\r\nmysql -uroot -p\r\n# 尝试修改密码,使用下面的命令修改root用户的密码\r\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY '你的密码';\r\n\r\n# 添加远程登陆\r\n# 创建一个能全局访问的用户root\r\n# CREATE USER 'root'@'%' IDENTIFIED BY 你的密码'';\r\n# 给用户授权任何远程主机都可以访问数据库 \r\nGRANT ALL PRIVILEGES ON *.* TO 'root'@'%'WITH GRANT OPTION;\r\n# 输入刷新命令使修改生效\r\nFLUSH PRIVILEGES;\r\n# 修改密码的加密方式\r\n# 找到mysql的配置文件vim /etc/my.cnf，把密码的加密方式改成之前版本的,8.0版本更换了密码的加密方式,我们就先用旧的\r\n# 找到default-authentication-plugin，将其注释取消\r\ndefault-authentication-plugin=mysql_native_password\r\n# 修改完my.cnf后重启服务，使其生效\r\nsystemctl restart mysqld\r\n\r\n# sql_mode=only_full_group_by问题\r\n# 查看sql_mode\r\nselect @@global.sql_mode;\r\n# 查询出来的值为：\r\nONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION\r\n\r\n# 修改my.cnf，在[mysqld]栏下新增sql_mode，将ONLY_FULL_GROUP_BY去掉\r\nvim /etc/my.cnf\r\nsql_mode='STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION'\r\n# 重启服务\r\nsystemctl restart mysqld\r\n```\r\n\r\n### rpm安装\r\n\r\n(1) 需要通过rpm相关指令，来查询当前系统中是否存在已安装的mysql软件包\r\n\r\n```shell\r\n# 查询当前系统中安装的所有软件\r\nrpm -qa\r\n# 查询当前系统中安装的名称带mysql的软件\r\nrpm -qa | grep mysql\r\n# 查询当前系统中安装的名称带mariadb的软件\r\nrpm -qa | grep mariadb\r\n```\r\n\r\n(2) 卸载\r\n\r\n```shell\r\nrpm -ev --nodeps 软件名称\r\n# 卸载之前请先关闭mysql服务，命令如下\r\nsystemctl stop mysqld\r\n# 依次卸载相关服务\r\nrpm -e --nodeps mysql-community-server\r\nrpm -e --nodeps mysql-community-client\r\nrpm -e --nodeps mysql-community-libs\r\nrpm -e --nodeps mysql-community-common\r\n#卸载mariadb\r\nrpm -e --nodeps mariadb-libs-5.5.64-1.el7.x86_64\r\n# 删除数据库配置文件\r\nrm -rf /etc/my.cnf\r\n# 删除数据库数据文件\r\nrm -rf /var/lib/mysql\r\n# 删除日志临时文件\r\nrm -rf /var/log/mysqld.log\r\n```\r\n\r\n(3) 下载rpm\r\n\r\n![下载](https://img-blog.csdnimg.cn/img_convert/7ec61ebdc9103cd70f3dd52efbd4ea19.png)\r\n或者使用wget\r\n\r\n```shell\r\n# 下载server包\r\nwget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-community-server-5.7.38-1.el7.x86_64.rpm\r\n# 下载client包\r\nwget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-community-client-5.7.38-1.el7.x86_64.rpm\r\n# 下载common包\r\nwget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-community-common-5.7.38-1.el7.x86_64.rpm\r\n# 下载libs包\r\nwget https://cdn.mysql.com//Downloads/MySQL-5.7/mysql-community-libs-5.7.38-1.el7.x86_64.rpm\r\n```\r\n\r\n(4) 安装\r\n\r\n> 包之间相互依赖，所以必须注意安装顺序\r\n> ```shell\r\n> # 相关依赖\r\n> yum install libaio -y\r\n> yum install net-tools -y\r\n> ```\r\n\r\n先装common,再装libs（确保mariadb已卸载，centos7默认支持mariadb，不支持mysql，不卸载会出现冲突）,再装client,最后装server\r\n```shell\r\n# i表示install安装；v表示verbose进度条；h表示hash哈希校验。\r\nrpm -ivh mysql-community-common-8.0.11-1.el7.x86_64.rpm\r\nrpm -ivh mysql-community-libs-8.0.11-1.el7.x86_64.rpm\r\n# rpm -ivh mysql-community-devel-5.7.25-1.el7.x86_64.rpm\r\n# rpm -ivh mysql-community-libs-compat-5.7.25-1.el7.x86_64.rpm\r\nrpm -ivh mysql-community-client-8.0.11-1.el7.x86_64.rpm\r\nrpm -ivh mysql-community-server-8.0.11-1.el7.x86_64.rpm\r\n```\r\n\r\n(5) 查看密码\r\n\r\n对于rpm安装的mysql，在mysql第一次启动时，会自动帮我们生成root用户的访问密码，并且输出在mysql的日志文件/var/log/mysqld.log中，我们可以查看这份日志文件，从而获取到访问密码\r\n```shell\r\ngrep 'temporary password' /var/log/mysqld.log\r\n# 或者\r\ncat /var/log/mysqld.log | grep password\r\n```\r\n\r\n(6) 配置其他内容如编码则新建`/etc/my.cnf`\r\n\r\n\r\n## Windows安装MySQL\r\n\r\n### 卸载\r\n```\r\n关闭mysql服务:net stop mysql\r\n删除mysql服务:mysqld -remove\r\n删除mysql相关文件夹，如想保留数据可保留data文件\r\n```\r\n### 安装\r\n\r\n(1) 解压mysql压缩包后进入mysql目录，新建my.ini文件并编辑\r\n\r\n```shell\r\n[mysqld]\r\n# 设置3306端口\r\nport = 3306\r\n# 设置mysql的安装目录\r\nbasedir=D:\\mysql\\mysql-5.8.11-winx64\r\n# 设置mysql数据库的数据的存放目录\r\ndatadir=D:\\mysql\\mysql-5.8.11-winx64\\data\r\n# 允许最大连接数\r\nmax_connections=200\r\n# 创建新表时将使用的默认存储引擎\r\ndefault-storage-engine=INNODB\r\n```\r\n\r\n(2) 将mysql加入环境变量\r\n\r\n(3) 管理员打开cmd切换到mysql bin目录下(一定要切换),执行**mysqld install**安装mysql服务，成功打印**service successfully installed**后执行**mysqld --initialize --console**会对数据库做初始化并打印相应日志：可以找到root@localhost之后的一串字符就是初始密码，然后执行net start mysql开启服务\r\n\r\n(4) 修改密码（5.7版本以前）\r\n\r\n```shell\r\n# mysql -uroot -p输入密码后\r\nset password for root@localhost = password('123456');\r\n# 8.0修改密码\r\nset password = '123456';\r\n```\r\n\r\n### 8.0连接navicat\r\n\r\nnavicat连接8.0需要把mysql用户登录密码加密规则还原成mysql_native_password\r\n\r\n```shell\r\nALTER USER 'root'@'localhost' IDENTIFIED BY 'root' PASSWORD EXPIRE NEVER; #修改加密规则\r\nALTER USER 'root'@'localhost' IDENTIFIED WITH mysql_native_password BY 'root'; #更新一下用户的密码\r\nFLUSH PRIVILEGES; #刷新权限\r\n# 然后use mysql;\r\nupdate user set host = '%' where user = 'root';\r\nFLUSH PRIVILEGES;\r\n```\r\n\r\n## 相关文章\r\n- [一文教你在CentOS7下安装MySQL及搭建主从复制](https://mp.weixin.qq.com/s?__biz=MzkzODE3OTI0Ng==&mid=2247491190&idx=1&sn=6e6ed61a51e2f214d19e304038bde8b4&source=41#wechat_redirect)\r\n- [手把手教大家搭建MySQL主从复制](https://mp.weixin.qq.com/s/R89aCCFvCvudLp6FUn2JjQ)","categories":[{"name":"数据库","path":"api/categories/数据库.json"}],"tags":[{"name":"安装","path":"api/tags/安装.json"}]}