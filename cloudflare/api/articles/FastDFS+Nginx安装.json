{"title":"FastDFS+Nginx安装","slug":"FastDFS+Nginx安装","date":"2024-07-01T08:01:36.380Z","updated":"2024-07-01T08:25:02.198Z","comments":true,"path":"api/articles/FastDFS+Nginx安装.json","excerpt":null,"covers":"https://img2.baidu.com/it/u=3204455731,2423486300&fm=253&fmt=auto&app=138&f=JPG?w=600&h=338","content":"\r\n\r\n从[此网站](https://github.com/happyfish100)下载相关压缩包，包括但不限于libfastcommon-master.zip、fastdfs-master.zip、fastdfs-nginx-module-master等\r\n\r\n### 安装所需的依赖包\r\n\r\n```shell\r\nyum install make cmake gcc gcc-c++\r\n```\r\n\r\n### 安装libfatscommon\r\n\r\n```shell\r\ncd /usr/local/src\r\nunzip libfastcommon-master.zip\r\ncd libfastcommon-master\r\n# 编译、安装\r\n./make.sh\r\n./make.sh install\r\n```\r\n\r\n### 安装FastDFS\r\n\r\n```shell\r\ncd /usr/local/src\r\nunzip fastdfs-master.zip\r\ncd fastdfs-master\r\n# 编译、安装\r\n./make.sh\r\n./make.sh install\r\ncp /etc/fdfs/tracker.conf.sample /etc/fdfs/tracker.conf # 跟踪服务配置\r\n```\r\n\r\n### 修改tracker.conf 文件\r\n\r\n```shell\r\ndisabled=false # 启用配置文件\r\nport=22122 # tracker服务器端口（默认22122）\r\nbase_path=/home/fastdfs # 存储日志和数据的根目录\r\n```\r\n\r\n### 创建目录\r\n\r\n```shell\r\nmkdir -p /home/fastdfs\r\n```\r\n\r\n### 开放端口\r\n\r\n```shell\r\nvi /etc/sysconfig/iptables\r\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 22122 -j ACCEPT\r\nservice iptables restart # 开放22122端口\r\n```\r\n\r\n### 启动tracker服务器\r\n\r\n```shell\r\n/etc/init.d/fdfs_trackerd start # 会在新建的/home/fastdfs生成log和data两个目录\r\n/etc/init.d/fdfs_trackerd stop # 停止tracker服务\r\n# 若无法启动，暂时用/usr/local/src/fastdfs-master/init.d/fdfs_trackerd start启动\r\n```\r\n\r\n### 设置开机启动\r\n\r\n```shell\r\nchkconfig fdfs_trakcerd on\r\n```\r\n\r\n### 存储服务配置\r\n\r\n```shell\r\ncp /etc/fdfs/storage.conf.sample /etc/fdfs/storage.conf\r\n\r\n# 修改的内容如下:\r\ndisabled=false # 启用配置文件\r\nport=23000 # storage服务端口\r\ngroup_name=group1 # 组名（第一组为group1，第二组为group2，依次类推...）\r\nbase_path=/home/fdfs_storage # 数据和日志文件存储根目录\r\nstore_path0=/home/fdfs_storage # 第一个存储目录，第二个存储目录起名为：#store_path1=xxx，其它存储目录名依次类推...\r\nstore_path_count=1 # 存储路径个数，需要和store_path个数匹配\r\ntracker_server=192.168.0.200:22122  # tracker服务器IP和端口\r\nhttp.server_port=80 # http访问文件的端口\r\n```\r\n\r\n### 创建目录 开放端口\r\n\r\n```shell\r\nmkdir -p /home/fdfs_storage\r\nvi /etc/sysconfig/iptables # 开放23000端口\r\n-A INPUT -m state --state NEW -m tcp -p tcp --dport 23000 -j ACCEPT \r\nservice iptables restart\r\n```\r\n\r\n### 启动storaged服务器\r\n\r\n```shell\r\n/etc/init.d/fdfs_storaged start #会在新建的/home/fdfs_storaged生成log和data两个目录\r\n/etc/init.d/fdfs_storaged stop# 停止服务(若无法启动，暂时用/usr/local/src/fastdfs-master/init.d/fdfs_storaged start启动)\r\n```\r\n\r\n### 设置storaged服务开机启动\r\n\r\n```shell\r\nchkconfig fdfs_storaged on \r\n```\r\n\r\n### 安装nginx\r\n\r\n1. wget http://nginx.org/download/nginx-1.15.2.tar.gz\r\n2. wget https://github.com/happyfish100/fastdfs-nginx-module/archive/V1.20.tar.gz\r\n3. 解压nginx：`tar -zxvf nginx-1.15.2.tar.gz`\r\n4. 解压fastdfs-nginx-module：`tar -xvf V1.20.tar.gz`\r\n5. 进入nginx目录：`cd nginx-1.10.1`\r\n6. 安装依赖的库`apt-get update`,`apt-get install libpcre3 libpcre3-dev openssl libssl-dev libperl-dev`\r\n7. 配置，并加载fastdfs-nginx-module模块：安装nginx的时候`./configure --prefix=/opt/nginx --sbin-path=/usr/bin/nginx --add-module=/usr/local/src/fastdfs-nginx-module-master/src`注意是否报错！\r\n8. 编译安装\r\n```shell\r\nmake && make install\r\ncp /usr/local/src/fastdfs-nginx-module-master/src/mod_fastdfs.conf  /etc/fdfs/\r\nvi /etc/fdfs/mod_fastdfs.conf\r\n\r\nconnect_timeout=10 # 客户端访问文件连接超时时长（单位：秒）\r\nbase_path=/tmp # 临时目录\r\ntracker_server=192.168.0.200:22122 # tracker服务IP和端口\r\nstorage_server_port=23000 # storage服务端口\r\ngroup_name=group1 # 组名\r\nurl_have_group_name=true # 访问链接前缀加上组名\r\nstore_path0=/home/fdfs_storage # 文件存储路径\r\ncd /usr/local/src/fastdfs-master/conf\r\ncp http.conf mime.types /etc/fdfs/\r\nln -s /home/fdfs_storage/data/ /home/fdfs_storage/data/M00\r\n```\r\nnginx.conf配置\r\n```nginx\r\n{\r\n    location ~/group([0-9])/M00 {\r\n        root /home/fdfs_storage/data\r\n            ngx_fastdfs_module;\r\n    }\r\n}\r\n```\r\n\r\n/usr/bin/nginx 启动\r\n\r\n### 相关文章\r\n\r\n| [FastDFS分布式文件系统集群安装与配置](https://blog.csdn.net/xyang81/article/details/52928230) | [FastDFS分布式文件系统安装与使用（单节点）](https://blog.csdn.net/xyang81/article/details/52837974) | [fastdfs安装配置](https://www.cnblogs.com/sunshinekevin/p/8085554.html) |\r\n| :----------------------------------------------------------: | :----------------------------------------------------------: | :----------------------------------------------------------: |\r\n| [分布式文件系统FastDFS安装教程](https://www.cnblogs.com/handsomeye/p/9451568.html) | [松哥手把手教你用FastDFS构建分布式文件管理系统](https://mp.weixin.qq.com/s/N20mYUnHPhdc76K5MayjFQ) | [需要搭建一个高性能的文件系统？我推荐你试试它](https://mp.weixin.qq.com/s/PMQU7Bsp6RQRig8gti3Grg) |\r\n| [再聊FastDFS，顺便说说OBS服务](https://mp.weixin.qq.com/s/0n0xNf9D8hrWCvAC8hmYfg) |                                                              |                                                              |\r\n\r\n","categories":[],"tags":[{"name":"安装","path":"api/tags/安装.json"}]}